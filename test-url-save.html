<!DOCTYPE html>
<html>
<head>
  <title>URL ì €ì¥ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
</head>
<body class="bg-gray-900 text-white p-4">
  <h1 class="text-2xl mb-4">URL ì €ì¥ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>

  <!-- í…ŒìŠ¤íŠ¸ìš© UI -->
  <div class="bg-gray-800 p-4 rounded-lg max-w-md">
    <button id="manage-players-btn" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded mb-4">
      ê´€ë¦¬ (í´ë¦­í•˜ì—¬ ëª¨ë‹¬ ì—´ê¸°)
    </button>

    <div id="test-modal" class="hidden bg-gray-700 p-4 rounded">
      <h2 class="text-lg font-bold mb-4">ê´€ë¦¬ ì„¤ì •</h2>

      <!-- Apps Script URL ì„¤ì • -->
      <div class="bg-gray-600 p-3 rounded">
        <label class="block text-sm mb-2">Apps Script URL</label>
        <input type="text" id="management-apps-url-input"
               class="w-full bg-gray-500 text-white rounded px-3 py-2 mb-2"
               placeholder="https://script.google.com/macros/s/.../exec">
        <button id="save-apps-url-btn" class="w-full bg-amber-600 hover:bg-amber-700 py-2 rounded">
          ğŸ’¾ URL ì €ì¥
        </button>
        <div class="text-xs mt-2">
          í˜„ì¬: <span id="management-current-url" class="text-gray-400"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- í”¼ë“œë°± í‘œì‹œ ì˜ì—­ -->
  <div id="feedback" class="mt-4 p-3 rounded hidden"></div>

  <script>
    // ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
    const DEFAULT_URL = "https://script.google.com/macros/s/AKfycbzbya/exec";
    let APPS_SCRIPT_URL = localStorage.getItem('appsScriptUrl') || DEFAULT_URL;

    function showFeedback(msg, isError = false) {
      const feedback = document.getElementById('feedback');
      feedback.textContent = msg;
      feedback.className = isError ?
        'mt-4 p-3 rounded bg-red-600' :
        'mt-4 p-3 rounded bg-green-600';
      feedback.classList.remove('hidden');
      setTimeout(() => feedback.classList.add('hidden'), 3000);
    }

    function updateAppsScriptUrl(newUrl) {
      if (newUrl && newUrl.includes('script.google.com')) {
        APPS_SCRIPT_URL = newUrl;
        localStorage.setItem('appsScriptUrl', newUrl);
        console.log('âœ… URL ì €ì¥ë¨:', newUrl);
        return true;
      }
      return false;
    }

    // ëª¨ë‹¬ í† ê¸€
    document.getElementById('manage-players-btn').addEventListener('click', () => {
      const modal = document.getElementById('test-modal');
      modal.classList.toggle('hidden');

      // URL í‘œì‹œ ì—…ë°ì´íŠ¸
      const currentUrlSpan = document.getElementById('management-current-url');
      if (currentUrlSpan) currentUrlSpan.textContent = APPS_SCRIPT_URL;
    });

    // URL ì €ì¥ ë²„íŠ¼
    const saveBtn = document.getElementById('save-apps-url-btn');
    console.log('ì €ì¥ ë²„íŠ¼:', saveBtn);

    if (saveBtn) {
      saveBtn.addEventListener('click', (e) => {
        e.preventDefault();
        console.log('URL ì €ì¥ ë²„íŠ¼ í´ë¦­ë¨');

        const urlInput = document.getElementById('management-apps-url-input');
        const newUrl = urlInput?.value.trim();

        console.log('ì…ë ¥ëœ URL:', newUrl);
        console.log('í˜„ì¬ URL:', APPS_SCRIPT_URL);

        if (newUrl && newUrl !== APPS_SCRIPT_URL) {
          if (updateAppsScriptUrl(newUrl)) {
            const currentUrlSpan = document.getElementById('management-current-url');
            if (currentUrlSpan) currentUrlSpan.textContent = newUrl;
            showFeedback('âœ… Apps Script URLì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
            urlInput.value = '';
          } else {
            showFeedback('âŒ ì˜¬ë°”ë¥¸ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤', true);
          }
        } else if (!newUrl) {
          showFeedback('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”', true);
        } else {
          showFeedback('ë™ì¼í•œ URLì…ë‹ˆë‹¤', true);
        }
      });
      console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
    } else {
      console.error('save-apps-url-btnì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
    }
  </script>
</body>
</html>