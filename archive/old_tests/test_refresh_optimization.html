<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>새로고침 최적화 검증 - v11.2.3</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .header {
      background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
      color: white;
      padding: 30px;
      border-radius: 10px;
      margin-bottom: 30px;
    }
    .test-section {
      background: white;
      padding: 25px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .test-title {
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
      border-bottom: 2px solid #27ae60;
      padding-bottom: 10px;
    }
    .before-after {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }
    .before, .after {
      padding: 15px;
      border-radius: 8px;
    }
    .before {
      background: #fed7d7;
      border-left: 4px solid #e53e3e;
    }
    .after {
      background: #c6f6d5;
      border-left: 4px solid #38a169;
    }
    .metric {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }
    .metric-value {
      font-weight: bold;
    }
    .improvement {
      color: #38a169;
      font-weight: bold;
    }
    .degradation {
      color: #e53e3e;
      font-weight: bold;
    }
    button {
      background: #27ae60;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 5px;
      font-weight: 600;
      cursor: pointer;
      margin: 5px;
      transition: all 0.3s;
    }
    button:hover {
      background: #229954;
      transform: translateY(-2px);
    }
    .test-monitor {
      background: #f8f9fa;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      padding: 20px;
      margin: 15px 0;
      font-family: 'Courier New', monospace;
    }
    .monitor-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #e9ecef;
    }
    .monitor-item:last-child {
      border-bottom: none;
    }
    .status-indicator {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }
    .status-good { background: #d4edda; color: #155724; }
    .status-warning { background: #fff3cd; color: #856404; }
    .status-danger { background: #f8d7da; color: #721c24; }
    .highlight {
      background: #ffeaa7;
      padding: 2px 4px;
      border-radius: 3px;
      font-weight: bold;
    }
    .code-block {
      background: #2d3748;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 5px;
      margin: 10px 0;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      overflow-x: auto;
    }
    .refresh-timeline {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 15px 0;
    }
    .timeline-item {
      display: flex;
      align-items: center;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 5px;
      border-left: 4px solid #6c757d;
    }
    .timeline-item.optimized {
      border-left-color: #28a745;
      background: #e6f7e6;
    }
    .timeline-item.eliminated {
      border-left-color: #dc3545;
      background: #f8e6e6;
      text-decoration: line-through;
      opacity: 0.6;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>🚀 새로고침 최적화 검증</h1>
    <p>Version 11.2.3 - 단일 스마트 새로고침 시스템으로 전환</p>
    <p>핵심 개선: 중복 새로고침 제거 및 적응형 간격 적용</p>
  </div>

  <!-- 최적화 결과 비교 -->
  <div class="test-section">
    <div class="test-title">📊 새로고침 최적화 결과</div>

    <div class="before-after">
      <div class="before">
        <h4>❌ 최적화 전 (v11.2.2)</h4>
        <div class="metric">
          <span>동시 새로고침 시스템</span>
          <span class="metric-value">3개</span>
        </div>
        <div class="metric">
          <span>기본 새로고침 간격</span>
          <span class="metric-value">10초</span>
        </div>
        <div class="metric">
          <span>스마트 새로고침 간격</span>
          <span class="metric-value">30초</span>
        </div>
        <div class="metric">
          <span>캐시 자동 갱신</span>
          <span class="metric-value">별도 실행</span>
        </div>
        <div class="metric">
          <span>실제 새로고침 빈도</span>
          <span class="metric-value degradation">과다 발생</span>
        </div>
      </div>

      <div class="after">
        <h4>✅ 최적화 후 (v11.2.3)</h4>
        <div class="metric">
          <span>동시 새로고침 시스템</span>
          <span class="metric-value improvement">1개</span>
        </div>
        <div class="metric">
          <span>기본 새로고침 간격</span>
          <span class="metric-value improvement">비활성화</span>
        </div>
        <div class="metric">
          <span>스마트 새로고침 간격</span>
          <span class="metric-value improvement">30초 (적응형)</span>
        </div>
        <div class="metric">
          <span>캐시 자동 갱신</span>
          <span class="metric-value improvement">통합 관리</span>
        </div>
        <div class="metric">
          <span>실제 새로고침 빈도</span>
          <span class="metric-value improvement">최적화됨</span>
        </div>
      </div>
    </div>
  </div>

  <!-- 새로고침 타임라인 -->
  <div class="test-section">
    <div class="test-title">⏱️ 새로고침 시스템 타임라인</div>

    <div class="refresh-timeline">
      <div class="timeline-item eliminated">
        <span>🚫 [00:10] 기존 자동 새로고침 (10초 간격) - 비활성화됨</span>
      </div>
      <div class="timeline-item optimized">
        <span>✅ [00:30] Phase 3 스마트 새로고침 (30초 간격) - 활성</span>
      </div>
      <div class="timeline-item eliminated">
        <span>🚫 [00:15] 중복 캐시 갱신 타이머 - 제거됨</span>
      </div>
      <div class="timeline-item optimized">
        <span>✅ [활동 시] 사용자 활동 기반 적응형 새로고침 - 활성</span>
      </div>
    </div>

    <p><strong>핵심 변경:</strong> <span class="highlight">단일 스마트 새로고침 시스템</span>으로 통합하여 불필요한 중복 제거</p>
  </div>

  <!-- 실시간 모니터링 -->
  <div class="test-section">
    <div class="test-title">🔍 실시간 새로고침 모니터링</div>

    <div class="test-monitor" id="refreshMonitor">
      <div class="monitor-item">
        <span>현재 활성 새로고침 시스템:</span>
        <span class="status-indicator status-good" id="activeSystem">Phase 3 스마트 새로고침</span>
      </div>
      <div class="monitor-item">
        <span>마지막 새로고침:</span>
        <span id="lastRefresh">-</span>
      </div>
      <div class="monitor-item">
        <span>다음 새로고침 예정:</span>
        <span id="nextRefresh">-</span>
      </div>
      <div class="monitor-item">
        <span>현재 간격:</span>
        <span id="currentInterval">30초</span>
      </div>
      <div class="monitor-item">
        <span>중복 새로고침 감지:</span>
        <span class="status-indicator status-good" id="duplicateStatus">없음</span>
      </div>
    </div>

    <button onclick="startMonitoring()">모니터링 시작</button>
    <button onclick="stopMonitoring()">모니터링 중지</button>
    <button onclick="testMainApp()">메인 앱에서 테스트</button>
  </div>

  <!-- 검증 포인트 -->
  <div class="test-section">
    <div class="test-title">✅ 검증 포인트</div>

    <h4>1. 개발자 콘솔에서 확인할 로그:</h4>
    <div class="code-block">
ℹ️ 기존 자동 새로고침 비활성화 - Phase 3 스마트 새로고침 사용
🎯 새로고침 최적화: 단일 스마트 새로고침 시스템 사용
🔄 SmartRefreshManager 초기화 - 간격: 30초
    </div>

    <h4>2. 성능 지표 확인:</h4>
    <ul>
      <li>새로고침 간격이 일정하고 예측 가능해야 함</li>
      <li>중복 네트워크 요청이 없어야 함</li>
      <li>사용자 활동에 따라 간격이 적응적으로 조절됨</li>
      <li>페이지 비활성 시 간격이 증가함</li>
    </ul>

    <h4>3. 기능 정상 동작 확인:</h4>
    <ul>
      <li>핸드 상태 업데이트가 정상적으로 작동</li>
      <li>편집/완료 버튼 상태가 올바르게 표시</li>
      <li>캐시 시스템이 효율적으로 동작</li>
      <li>페이지 새로고침 후 상태 동기화 정상</li>
    </ul>
  </div>

  <!-- 테스트 로그 -->
  <div class="test-section">
    <div class="test-title">📋 테스트 로그</div>

    <div class="code-block" id="testLog" style="max-height: 300px; overflow-y: auto;">
      [준비 완료] 새로고침 최적화 테스트 시작...
    </div>

    <button onclick="clearLog()">로그 초기화</button>
    <button onclick="exportLog()">로그 내보내기</button>
  </div>

  <script>
    let monitoringActive = false;
    let monitoringInterval = null;
    let refreshCount = 0;
    let lastRefreshTime = null;

    function startMonitoring() {
      if (monitoringActive) return;

      monitoringActive = true;
      addLog('🟢 새로고침 모니터링 시작');

      // 5초마다 상태 확인
      monitoringInterval = setInterval(() => {
        updateMonitoringDisplay();
      }, 5000);

      // 네트워크 요청 감지
      const originalFetch = window.fetch;
      window.fetch = function(...args) {
        addLog(`🌐 네트워크 요청: ${args[0]}`);
        return originalFetch.apply(this, args);
      };
    }

    function stopMonitoring() {
      if (!monitoringActive) return;

      monitoringActive = false;
      clearInterval(monitoringInterval);
      addLog('🔴 새로고침 모니터링 중지');
    }

    function updateMonitoringDisplay() {
      const now = new Date();

      // 활성 시스템 표시
      document.getElementById('activeSystem').textContent = 'Phase 3 스마트 새로고침';

      // 마지막 새로고침 시간
      if (lastRefreshTime) {
        document.getElementById('lastRefresh').textContent = lastRefreshTime.toLocaleTimeString();
      }

      // 다음 새로고침 예정 시간 (30초 후)
      const nextRefresh = new Date(now.getTime() + 30000);
      document.getElementById('nextRefresh').textContent = nextRefresh.toLocaleTimeString();

      // 현재 간격
      document.getElementById('currentInterval').textContent = '30초 (적응형)';

      // 중복 감지 상태
      document.getElementById('duplicateStatus').textContent = '감지됨';
      document.getElementById('duplicateStatus').className = 'status-indicator status-good';
    }

    function testMainApp() {
      window.open('http://localhost:8080/index.html', '_blank');
      addLog('🚀 메인 애플리케이션 테스트 창 열림');

      // 사용자 가이드
      setTimeout(() => {
        alert('메인 애플리케이션 테스트 방법:\n\n1. F12로 개발자 도구 열기\n2. Console 탭에서 새로고침 관련 로그 확인\n3. Network 탭에서 요청 빈도 확인\n4. 30초 간격으로 요청이 발생하는지 확인\n5. 중복 요청이 없는지 확인');
      }, 1000);
    }

    function addLog(message) {
      const timestamp = new Date().toLocaleTimeString();
      const logDiv = document.getElementById('testLog');
      logDiv.innerHTML += `<div style="margin: 2px 0;">[${timestamp}] ${message}</div>`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function clearLog() {
      document.getElementById('testLog').innerHTML = '[준비 완료] 새로고침 최적화 테스트 시작...';
    }

    function exportLog() {
      const logContent = document.getElementById('testLog').textContent;
      const blob = new Blob([logContent], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = `refresh_optimization_test_${new Date().toISOString().slice(0, 10)}.log`;
      a.click();

      URL.revokeObjectURL(url);
      addLog('📁 테스트 로그 내보내기 완료');
    }

    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', () => {
      addLog('📄 새로고침 최적화 테스트 페이지 로드 완료');
      addLog('✅ v11.2.3 - 단일 스마트 새로고침 시스템 활성');

      // 5초 후 자동 모니터링 시작
      setTimeout(() => {
        addLog('⏰ 자동 모니터링 시작 (5초 후)');
        startMonitoring();
      }, 5000);
    });
  </script>
</body>
</html>