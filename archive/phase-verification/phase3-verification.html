<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phase 3 ê²€ì¦ - ëª¨ë°”ì¼ ìµœì í™”</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(45deg, #ff6b6b, #ee5a24);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: 700;
    }

    .header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .test-section {
      padding: 30px;
      border-bottom: 1px solid #e5e7eb;
    }

    .test-section:last-child {
      border-bottom: none;
    }

    .test-section h2 {
      color: #1f2937;
      margin-bottom: 20px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
    }

    .test-section h2::before {
      content: attr(data-icon);
      font-size: 1.2em;
      margin-right: 10px;
    }

    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .test-item {
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .test-item:hover {
      border-color: #3b82f6;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
    }

    .test-item.passed {
      border-color: #10b981;
      background: #ecfdf5;
    }

    .test-item.failed {
      border-color: #ef4444;
      background: #fef2f2;
    }

    .test-item h3 {
      color: #1f2937;
      margin-bottom: 8px;
      font-size: 1.1em;
    }

    .test-item p {
      color: #6b7280;
      font-size: 0.9em;
      margin-bottom: 12px;
    }

    .test-result {
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.85em;
    }

    .test-result.passed {
      background: #d1fae5;
      color: #065f46;
    }

    .test-result.failed {
      background: #fee2e2;
      color: #991b1b;
    }

    .test-result.pending {
      background: #fef3c7;
      color: #92400e;
    }

    .demo-area {
      background: #f3f4f6;
      border-radius: 8px;
      padding: 20px;
      margin-top: 15px;
    }

    .button-demo {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .demo-button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 44px;
      min-height: 44px;
    }

    .demo-button.primary {
      background: #3b82f6;
      color: white;
    }

    .demo-button.danger {
      background: #ef4444;
      color: white;
    }

    .demo-button.success {
      background: #10b981;
      color: white;
    }

    .virtual-scroll-demo {
      height: 300px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      overflow: hidden;
    }

    .swipe-demo {
      background: #ddd6fe;
      border-radius: 8px;
      padding: 30px;
      text-align: center;
      border: 2px dashed #8b5cf6;
      margin: 15px 0;
    }

    .logs {
      background: #1f2937;
      color: #e5e7eb;
      border-radius: 8px;
      padding: 15px;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 15px;
    }

    .progress {
      width: 100%;
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
      margin: 20px 0;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #1d4ed8);
      transition: width 0.3s ease;
      width: 0%;
    }

    .stats {
      display: flex;
      justify-content: space-around;
      background: #f8fafc;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-size: 2em;
      font-weight: bold;
      color: #1f2937;
    }

    .stat-label {
      color: #6b7280;
      font-size: 0.9em;
      margin-top: 5px;
    }

    @media (max-width: 768px) {
      .container {
        margin: 10px;
        border-radius: 12px;
      }

      .header {
        padding: 20px;
      }

      .header h1 {
        font-size: 2em;
      }

      .test-section {
        padding: 20px;
      }

      .test-grid {
        grid-template-columns: 1fr;
      }

      .stats {
        flex-direction: column;
        gap: 15px;
      }
    }

    .long-press-demo {
      background: #fef3c7;
      border: 2px dashed #f59e0b;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      margin: 10px 0;
    }

    .offline-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.9em;
      font-weight: 500;
    }

    .offline-status.online {
      background: #d1fae5;
      color: #065f46;
    }

    .offline-status.offline {
      background: #fee2e2;
      color: #991b1b;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¯ Phase 3 ê²€ì¦</h1>
      <p>ëª¨ë°”ì¼ ìµœì í™” ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</p>
    </div>

    <!-- ì „ì²´ ì§„í–‰ë¥  -->
    <div class="test-section">
      <h2 data-icon="ğŸ“Š">ì „ì²´ ì§„í–‰ë¥ </h2>
      <div class="progress">
        <div class="progress-bar" id="overall-progress"></div>
      </div>
      <div class="stats">
        <div class="stat">
          <div class="stat-value" id="passed-count">0</div>
          <div class="stat-label">í†µê³¼</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="failed-count">0</div>
          <div class="stat-label">ì‹¤íŒ¨</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="total-count">0</div>
          <div class="stat-label">ì „ì²´</div>
        </div>
      </div>
    </div>

    <!-- 1. í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ ìµœì í™” -->
    <div class="test-section">
      <h2 data-icon="ğŸ‘†">í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ ìµœì í™”</h2>
      <div class="test-grid">
        <div class="test-item" id="test-touch-size">
          <h3>ìµœì†Œ í„°ì¹˜ í¬ê¸° (44x44px)</h3>
          <p>ëª¨ë“  í„°ì¹˜ ê°€ëŠ¥í•œ ìš”ì†Œê°€ ìµœì†Œ í¬ê¸°ë¥¼ ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-touch-response">
          <h3>í„°ì¹˜ ì‘ë‹µ ì‹œê°„</h3>
          <p>í„°ì¹˜ ì´ë²¤íŠ¸ ì‘ë‹µ ì‹œê°„ì´ 50ms ì´í•˜ì¸ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-double-tap-prevention">
          <h3>ë”ë¸”íƒ­ ì¤Œ ë°©ì§€</h3>
          <p>ì˜ë„í•˜ì§€ ì•Šì€ ë”ë¸”íƒ­ ì¤Œì´ ë°©ì§€ë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>
      <div class="demo-area">
        <h4>í„°ì¹˜ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤</h4>
        <div class="button-demo">
          <button class="demo-button primary" data-test="touch">í„°ì¹˜ í…ŒìŠ¤íŠ¸</button>
          <button class="demo-button success" data-test="response">ì‘ë‹µ ì‹œê°„</button>
          <button class="demo-button danger" data-test="double-tap">ë”ë¸”íƒ­ ë°©ì§€</button>
        </div>
      </div>
    </div>

    <!-- 2. ì œìŠ¤ì²˜ ì‹œìŠ¤í…œ -->
    <div class="test-section">
      <h2 data-icon="ğŸ‘‹">ì œìŠ¤ì²˜ ì‹œìŠ¤í…œ</h2>
      <div class="test-grid">
        <div class="test-item" id="test-swipe-gesture">
          <h3>ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜</h3>
          <p>ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„ë¡œ ì‹¤í–‰ì·¨ì†Œê°€ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-long-press">
          <h3>ë¡±í”„ë ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´</h3>
          <p>ë¡±í”„ë ˆìŠ¤ë¡œ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ê°€ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-haptic-feedback">
          <h3>í–…í‹± í”¼ë“œë°±</h3>
          <p>í„°ì¹˜ ì•¡ì…˜ì— í–…í‹± í”¼ë“œë°±ì´ ì œê³µë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>
      <div class="demo-area">
        <div class="swipe-demo" id="swipe-area">
          <p>ğŸš€ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„í•´ë³´ì„¸ìš”!</p>
          <small>ìŠ¤ì™€ì´í”„í•˜ë©´ ì‹¤í–‰ì·¨ì†Œ ì•¡ì…˜ì´ ì‹¤í–‰ë©ë‹ˆë‹¤</small>
        </div>
        <div class="long-press-demo" data-long-press="player">
          <p>ğŸ‘† ì—¬ê¸°ë¥¼ ê¸¸ê²Œ ëˆŒëŸ¬ë³´ì„¸ìš” (500ms)</p>
          <small>ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ê°€ í‘œì‹œë©ë‹ˆë‹¤</small>
        </div>
      </div>
    </div>

    <!-- 3. ê°€ìƒ ìŠ¤í¬ë¡¤ -->
    <div class="test-section">
      <h2 data-icon="ğŸ“œ">ê°€ìƒ ìŠ¤í¬ë¡¤</h2>
      <div class="test-grid">
        <div class="test-item" id="test-virtual-scroll-performance">
          <h3>ì„±ëŠ¥ ìµœì í™”</h3>
          <p>1000ê°œ ì•„ì´í…œë„ ë¶€ë“œëŸ½ê²Œ ìŠ¤í¬ë¡¤ë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-virtual-scroll-memory">
          <h3>ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±</h3>
          <p>DOM ìš”ì†Œê°€ ì¬í™œìš©ë˜ì–´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¼ì •í•œì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>
      <div class="demo-area">
        <h4>ê°€ìƒ ìŠ¤í¬ë¡¤ ë°ëª¨ (1000ê°œ í”Œë ˆì´ì–´)</h4>
        <div class="virtual-scroll-demo" id="virtual-scroll-container"></div>
      </div>
    </div>

    <!-- 4. ì˜¤í”„ë¼ì¸ ì§€ì› -->
    <div class="test-section">
      <h2 data-icon="ğŸ“±">ì˜¤í”„ë¼ì¸ ì§€ì›</h2>
      <div class="test-grid">
        <div class="test-item" id="test-indexeddb">
          <h3>IndexedDB ì €ì¥</h3>
          <p>ë°ì´í„°ê°€ IndexedDBì— ì €ì¥ë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-offline-mode">
          <h3>ì˜¤í”„ë¼ì¸ ëª¨ë“œ</h3>
          <p>ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì—†ì´ë„ ì•±ì´ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-sync-queue">
          <h3>ë™ê¸°í™” í</h3>
          <p>ì˜¨ë¼ì¸ ë³µêµ¬ ì‹œ ë°ì´í„°ê°€ ë™ê¸°í™”ë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>
      <div class="demo-area">
        <div class="offline-status" id="offline-status">
          <span>ğŸŒ</span>
          <span>ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...</span>
        </div>
        <div class="button-demo">
          <button class="demo-button primary" id="save-offline-btn">ì˜¤í”„ë¼ì¸ ì €ì¥</button>
          <button class="demo-button success" id="load-offline-btn">ì˜¤í”„ë¼ì¸ ë¡œë“œ</button>
          <button class="demo-button danger" id="simulate-offline-btn">ì˜¤í”„ë¼ì¸ ì‹œë®¬ë ˆì´ì…˜</button>
        </div>
      </div>
    </div>

    <!-- ë¡œê·¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ“‹">í…ŒìŠ¤íŠ¸ ë¡œê·¸</h2>
      <div class="logs" id="test-logs">
        <div>Phase 3 í…ŒìŠ¤íŠ¸ ì‹œì‘...</div>
      </div>
    </div>
  </div>

  <!-- Phase 3 ëª¨ë“ˆë“¤ ë¡œë“œ -->
  <script src="action-history.js"></script>
  <script src="mobile-optimizer.js"></script>
  <script src="virtual-scroll.js"></script>
  <script src="offline-storage.js"></script>

  <script>
    class Phase3Tester {
      constructor() {
        this.tests = [];
        this.passedCount = 0;
        this.failedCount = 0;
        this.totalCount = 0;

        this.init();
      }

      init() {
        this.setupTests();
        this.startTesting();
        this.setupDemoHandlers();
      }

      setupTests() {
        // í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ í…ŒìŠ¤íŠ¸
        this.addTest('test-touch-size', 'í„°ì¹˜ í¬ê¸° ê²€ì‚¬', this.testTouchSize.bind(this));
        this.addTest('test-touch-response', 'í„°ì¹˜ ì‘ë‹µ ì‹œê°„', this.testTouchResponse.bind(this));
        this.addTest('test-double-tap-prevention', 'ë”ë¸”íƒ­ ë°©ì§€', this.testDoubleTapPrevention.bind(this));

        // ì œìŠ¤ì²˜ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        this.addTest('test-swipe-gesture', 'ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜', this.testSwipeGesture.bind(this));
        this.addTest('test-long-press', 'ë¡±í”„ë ˆìŠ¤', this.testLongPress.bind(this));
        this.addTest('test-haptic-feedback', 'í–…í‹± í”¼ë“œë°±', this.testHapticFeedback.bind(this));

        // ê°€ìƒ ìŠ¤í¬ë¡¤ í…ŒìŠ¤íŠ¸
        this.addTest('test-virtual-scroll-performance', 'ê°€ìƒ ìŠ¤í¬ë¡¤ ì„±ëŠ¥', this.testVirtualScrollPerformance.bind(this));
        this.addTest('test-virtual-scroll-memory', 'ê°€ìƒ ìŠ¤í¬ë¡¤ ë©”ëª¨ë¦¬', this.testVirtualScrollMemory.bind(this));

        // ì˜¤í”„ë¼ì¸ ì§€ì› í…ŒìŠ¤íŠ¸
        this.addTest('test-indexeddb', 'IndexedDB', this.testIndexedDB.bind(this));
        this.addTest('test-offline-mode', 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ', this.testOfflineMode.bind(this));
        this.addTest('test-sync-queue', 'ë™ê¸°í™” í', this.testSyncQueue.bind(this));

        this.totalCount = this.tests.length;
        document.getElementById('total-count').textContent = this.totalCount;
      }

      addTest(id, name, testFunc) {
        this.tests.push({ id, name, testFunc });
      }

      async startTesting() {
        this.log('ğŸ§ª Phase 3 í…ŒìŠ¤íŠ¸ ì‹œì‘...');

        for (const test of this.tests) {
          try {
            this.log(`âš¡ ${test.name} í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...`);
            const passed = await test.testFunc();
            this.updateTestResult(test.id, passed);
          } catch (error) {
            this.log(`âŒ ${test.name} í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}`);
            this.updateTestResult(test.id, false);
          }

          await this.delay(500); // í…ŒìŠ¤íŠ¸ ê°„ ë”œë ˆì´
        }

        this.log('âœ… Phase 3 í…ŒìŠ¤íŠ¸ ì™„ë£Œ!');
        this.showFinalResults();
      }

      async testTouchSize() {
        const buttons = document.querySelectorAll('button, [role="button"]');
        let allValid = true;

        buttons.forEach(button => {
          const rect = button.getBoundingClientRect();
          if (rect.width < 44 || rect.height < 44) {
            allValid = false;
            this.log(`âš ï¸ í„°ì¹˜ í¬ê¸° ë¶€ì¡±: ${button.textContent} (${rect.width}x${rect.height})`);
          }
        });

        return allValid;
      }

      async testTouchResponse() {
        return new Promise((resolve) => {
          const button = document.querySelector('[data-test="response"]');
          const startTime = performance.now();

          const handler = () => {
            const responseTime = performance.now() - startTime;
            this.log(`â±ï¸ í„°ì¹˜ ì‘ë‹µ ì‹œê°„: ${responseTime.toFixed(2)}ms`);
            button.removeEventListener('touchend', handler);
            resolve(responseTime <= 50);
          };

          button.addEventListener('touchend', handler);

          // ìë™ íŠ¸ë¦¬ê±° (ëª¨ë°”ì¼ì´ ì•„ë‹Œ ê²½ìš°)
          setTimeout(() => {
            if (button.onclick) {
              button.click();
              const responseTime = performance.now() - startTime;
              this.log(`â±ï¸ í´ë¦­ ì‘ë‹µ ì‹œê°„: ${responseTime.toFixed(2)}ms`);
              resolve(responseTime <= 50);
            }
          }, 100);
        });
      }

      async testDoubleTapPrevention() {
        // ë”ë¸”íƒ­ ë°©ì§€ ë¡œì§ì´ ìˆëŠ”ì§€ í™•ì¸
        const hasPreventionLogic = document.addEventListener.toString().includes('touchend');
        return hasPreventionLogic;
      }

      async testSwipeGesture() {
        return window.mobileOptimizer && typeof window.mobileOptimizer.handleSwipe === 'function';
      }

      async testLongPress() {
        return window.mobileOptimizer && typeof window.mobileOptimizer.handleLongPress === 'function';
      }

      async testHapticFeedback() {
        return navigator.vibrate !== undefined || window.mobileOptimizer?.hasVibration;
      }

      async testVirtualScrollPerformance() {
        if (!window.VirtualScroll) return false;

        const container = document.getElementById('virtual-scroll-container');
        const virtualScroll = new window.PlayerVirtualScroll(container);

        // 1000ê°œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
        const testData = Array.from({length: 1000}, (_, i) => ({
          id: i,
          name: `í…ŒìŠ¤íŠ¸ í”Œë ˆì´ì–´ ${i + 1}`,
          chips: Math.floor(Math.random() * 10000),
          status: i % 10 === 0 ? 'OUT' : 'IN'
        }));

        virtualScroll.setItems(testData);
        this.log(`ğŸ“œ ê°€ìƒ ìŠ¤í¬ë¡¤: ${testData.length}ê°œ ì•„ì´í…œ ë Œë”ë§ ì™„ë£Œ`);

        return true;
      }

      async testVirtualScrollMemory() {
        // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì²´í¬ (ê°€ëŠ¥í•œ ê²½ìš°)
        if (performance.memory) {
          const before = performance.memory.usedJSHeapSize;
          await this.testVirtualScrollPerformance();
          const after = performance.memory.usedJSHeapSize;
          const increase = after - before;
          this.log(`ğŸ’¾ ë©”ëª¨ë¦¬ ì¦ê°€ëŸ‰: ${(increase / 1024 / 1024).toFixed(2)} MB`);
          return increase < 5 * 1024 * 1024; // 5MB ì´í•˜
        }
        return true;
      }

      async testIndexedDB() {
        if (!window.offlineStorage) return false;

        try {
          // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥
          await window.offlineStorage.save('players', {
            id: 'test-player',
            name: 'í…ŒìŠ¤íŠ¸ í”Œë ˆì´ì–´',
            chips: 1000
          });

          // ë°ì´í„° ì¡°íšŒ
          const saved = await window.offlineStorage.get('players', 'test-player');
          this.log('ğŸ’¾ IndexedDB ì €ì¥/ë¡œë“œ ì„±ê³µ');
          return saved && saved.name === 'í…ŒìŠ¤íŠ¸ í”Œë ˆì´ì–´';
        } catch (error) {
          this.log(`âŒ IndexedDB ì˜¤ë¥˜: ${error.message}`);
          return false;
        }
      }

      async testOfflineMode() {
        return window.offlineStorage && typeof window.offlineStorage.isOffline === 'function';
      }

      async testSyncQueue() {
        if (!window.offlineStorage) return false;

        const status = await window.offlineStorage.getSyncStatus();
        this.log(`ğŸ”„ ë™ê¸°í™” ìƒíƒœ: ${status.isOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}`);
        return typeof status.pendingSync === 'number';
      }

      updateTestResult(testId, passed) {
        const element = document.getElementById(testId);
        const resultEl = element.querySelector('.test-result');

        if (passed) {
          element.classList.add('passed');
          resultEl.classList.add('passed');
          resultEl.textContent = 'âœ… í†µê³¼';
          this.passedCount++;
        } else {
          element.classList.add('failed');
          resultEl.classList.add('failed');
          resultEl.textContent = 'âŒ ì‹¤íŒ¨';
          this.failedCount++;
        }

        this.updateProgress();
      }

      updateProgress() {
        const progress = ((this.passedCount + this.failedCount) / this.totalCount) * 100;
        document.getElementById('overall-progress').style.width = progress + '%';
        document.getElementById('passed-count').textContent = this.passedCount;
        document.getElementById('failed-count').textContent = this.failedCount;
      }

      showFinalResults() {
        const successRate = (this.passedCount / this.totalCount * 100).toFixed(1);
        this.log(`ğŸ“Š ìµœì¢… ê²°ê³¼: ${this.passedCount}/${this.totalCount} í†µê³¼ (${successRate}%)`);

        if (this.passedCount === this.totalCount) {
          this.log('ğŸ‰ Phase 3 ê²€ì¦ ì™„ë£Œ! ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼');
        } else {
          this.log(`âš ï¸ ${this.failedCount}ê°œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ - ì¶”ê°€ í™•ì¸ í•„ìš”`);
        }
      }

      setupDemoHandlers() {
        // ì˜¤í”„ë¼ì¸ ìƒíƒœ í‘œì‹œ
        this.updateOfflineStatus();
        window.addEventListener('online', () => this.updateOfflineStatus());
        window.addEventListener('offline', () => this.updateOfflineStatus());

        // ë°ëª¨ ë²„íŠ¼ í•¸ë“¤ëŸ¬
        document.getElementById('save-offline-btn')?.addEventListener('click', async () => {
          if (window.offlineStorage) {
            await window.offlineStorage.save('players', {
              id: Date.now(),
              name: 'ì˜¤í”„ë¼ì¸ í…ŒìŠ¤íŠ¸',
              chips: 5000
            });
            this.log('ğŸ’¾ ì˜¤í”„ë¼ì¸ ë°ì´í„° ì €ì¥ë¨');
          }
        });

        document.getElementById('simulate-offline-btn')?.addEventListener('click', () => {
          // ì˜¤í”„ë¼ì¸ ì‹œë®¬ë ˆì´ì…˜
          window.dispatchEvent(new Event('offline'));
          this.log('ğŸ“± ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì‹œë®¬ë ˆì´ì…˜');

          setTimeout(() => {
            window.dispatchEvent(new Event('online'));
            this.log('ğŸŒ ì˜¨ë¼ì¸ ëª¨ë“œ ë³µêµ¬');
          }, 3000);
        });
      }

      updateOfflineStatus() {
        const statusEl = document.getElementById('offline-status');
        const isOnline = navigator.onLine;

        statusEl.className = 'offline-status ' + (isOnline ? 'online' : 'offline');
        statusEl.innerHTML = `
          <span>${isOnline ? 'ğŸŒ' : 'ğŸ“±'}</span>
          <span>${isOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}</span>
        `;
      }

      log(message) {
        const logs = document.getElementById('test-logs');
        const timestamp = new Date().toLocaleTimeString();
        logs.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        logs.scrollTop = logs.scrollHeight;
      }

      delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
    }

    // í˜ì´ì§€ ë¡œë“œ í›„ í…ŒìŠ¤íŠ¸ ì‹œì‘
    document.addEventListener('DOMContentLoaded', () => {
      new Phase3Tester();
    });
  </script>
</body>
</html>