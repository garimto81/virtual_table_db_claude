<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phase 4 ê¸°ê¸° í…ŒìŠ¤íŠ¸ - ì‹¤ë¬´ í™˜ê²½ ê²€ì¦</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
      min-height: 100vh;
      padding: 10px;
      color: white;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(45deg, #e53e3e, #d53f8c);
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: 700;
    }

    .header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .device-info {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .device-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .device-stat {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .device-stat h3 {
      font-size: 0.9em;
      opacity: 0.8;
      margin-bottom: 8px;
    }

    .device-stat .value {
      font-size: 1.5em;
      font-weight: bold;
      color: #68d391;
    }

    .test-section {
      padding: 30px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .test-section:last-child {
      border-bottom: none;
    }

    .test-section h2 {
      margin-bottom: 20px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
    }

    .test-section h2::before {
      content: attr(data-icon);
      font-size: 1.2em;
      margin-right: 10px;
    }

    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .test-item {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .test-item:hover {
      border-color: #3182ce;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(49, 130, 206, 0.3);
    }

    .test-item.passed {
      border-color: #38a169;
      background: rgba(56, 161, 105, 0.1);
    }

    .test-item.failed {
      border-color: #e53e3e;
      background: rgba(229, 62, 62, 0.1);
    }

    .test-item.running {
      border-color: #ed8936;
      background: rgba(237, 137, 54, 0.1);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .test-item h3 {
      margin-bottom: 8px;
      font-size: 1.1em;
    }

    .test-item p {
      opacity: 0.8;
      font-size: 0.9em;
      margin-bottom: 12px;
    }

    .test-result {
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.85em;
      display: inline-block;
    }

    .test-result.passed {
      background: rgba(56, 161, 105, 0.2);
      color: #68d391;
    }

    .test-result.failed {
      background: rgba(229, 62, 62, 0.2);
      color: #fc8181;
    }

    .test-result.pending {
      background: rgba(237, 137, 54, 0.2);
      color: #f6ad55;
    }

    .test-result.running {
      background: rgba(66, 153, 225, 0.2);
      color: #90cdf4;
    }

    .stress-test-area {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 20px;
      margin-top: 15px;
    }

    .stress-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .stress-button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 44px;
      min-height: 44px;
    }

    .stress-button.start {
      background: #38a169;
      color: white;
    }

    .stress-button.stop {
      background: #e53e3e;
      color: white;
    }

    .stress-button.reset {
      background: #3182ce;
      color: white;
    }

    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .metric {
      background: rgba(255, 255, 255, 0.05);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .metric-value {
      font-size: 1.8em;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .metric-label {
      font-size: 0.85em;
      opacity: 0.8;
    }

    .metric.good .metric-value { color: #68d391; }
    .metric.warning .metric-value { color: #f6ad55; }
    .metric.danger .metric-value { color: #fc8181; }

    .logs {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 15px;
    }

    .progress-circle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin: 0 auto 10px;
    }

    .progress-circle.completed {
      background: conic-gradient(#38a169 var(--progress, 0%), rgba(255,255,255,0.1) 0%);
    }

    .device-compatibility {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }

    .device-test {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 15px;
      border-left: 4px solid transparent;
    }

    .device-test.unknown { border-left-color: #a0aec0; }
    .device-test.testing { border-left-color: #3182ce; }
    .device-test.passed { border-left-color: #38a169; }
    .device-test.failed { border-left-color: #e53e3e; }

    .device-test h4 {
      margin-bottom: 8px;
      font-size: 1em;
    }

    .device-test .device-specs {
      font-size: 0.8em;
      opacity: 0.7;
      margin-bottom: 8px;
    }

    .scenario-test {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 20px;
      margin: 10px 0;
    }

    .scenario-test h4 {
      margin-bottom: 10px;
      color: #90cdf4;
    }

    .scenario-steps {
      list-style: none;
      padding: 0;
    }

    .scenario-steps li {
      padding: 5px 0;
      border-left: 2px solid transparent;
      padding-left: 15px;
      margin: 5px 0;
    }

    .scenario-steps li.completed { border-left-color: #38a169; color: #68d391; }
    .scenario-steps li.current { border-left-color: #3182ce; color: #90cdf4; }
    .scenario-steps li.failed { border-left-color: #e53e3e; color: #fc8181; }

    @media (max-width: 768px) {
      .container {
        margin: 5px;
        border-radius: 12px;
      }

      .header {
        padding: 20px;
      }

      .header h1 {
        font-size: 2em;
      }

      .test-section {
        padding: 20px;
      }

      .test-grid {
        grid-template-columns: 1fr;
      }

      .device-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .metrics {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ Phase 4 ì‹¤ë¬´ ê²€ì¦</h1>
      <p>ì‹¤ì œ í™˜ê²½ì—ì„œì˜ ìµœì¢… í†µí•© í…ŒìŠ¤íŠ¸</p>
    </div>

    <!-- ê¸°ê¸° ì •ë³´ -->
    <div class="device-info">
      <h2 data-icon="ğŸ“±">í˜„ì¬ ê¸°ê¸° ì •ë³´</h2>
      <div class="device-grid">
        <div class="device-stat">
          <h3>ê¸°ê¸°</h3>
          <div class="value" id="device-name">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>ë¸Œë¼ìš°ì €</h3>
          <div class="value" id="browser-name">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>í™”ë©´ í¬ê¸°</h3>
          <div class="value" id="screen-size">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>ë©”ëª¨ë¦¬</h3>
          <div class="value" id="memory-info">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>ë„¤íŠ¸ì›Œí¬</h3>
          <div class="value" id="network-info">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>í„°ì¹˜ ì§€ì›</h3>
          <div class="value" id="touch-support">ê°ì§€ ì¤‘...</div>
        </div>
      </div>
    </div>

    <!-- ê¸°ê¸° í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ“±">ê¸°ê¸° í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ (10ì¢…)</h2>
      <div class="device-compatibility">
        <div class="device-test unknown" id="iphone-12-mini">
          <h4>iPhone 12 mini</h4>
          <div class="device-specs">iOS 14+, A14 Bionic, 5.4"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test unknown" id="iphone-14-pro">
          <h4>iPhone 14 Pro</h4>
          <div class="device-specs">iOS 16+, A16 Bionic, 6.1"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test unknown" id="galaxy-s23">
          <h4>Galaxy S23</h4>
          <div class="device-specs">Android 13, Snapdragon 8 Gen 2, 6.1"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test unknown" id="galaxy-a32">
          <h4>Galaxy A32</h4>
          <div class="device-specs">Android 11, MediaTek Helio G80, 6.4"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test unknown" id="ipad-mini">
          <h4>iPad mini</h4>
          <div class="device-specs">iPadOS 15+, A15 Bionic, 8.3"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test testing" id="current-device">
          <h4>í˜„ì¬ ê¸°ê¸°</h4>
          <div class="device-specs" id="current-specs">ìë™ ê°ì§€ ì¤‘...</div>
          <div class="test-result running">í…ŒìŠ¤íŠ¸ ì¤‘</div>
        </div>
      </div>
    </div>

    <!-- ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ¯">ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸</h2>
      <div class="test-grid">
        <div class="test-item" id="scenario-1">
          <h3>30ì´ˆ ë‚´ 10ëª… ë“±ë¡</h3>
          <p>ë¹ ë¥¸ í”Œë ˆì´ì–´ ë“±ë¡ ì‹œë‚˜ë¦¬ì˜¤ (ë”œëŸ¬ í…ŒìŠ¤íŠ¸)</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
          <div class="scenario-test">
            <h4>í…ŒìŠ¤íŠ¸ ë‹¨ê³„</h4>
            <ul class="scenario-steps">
              <li>10ëª… ì—°ì† ì¶”ê°€ (3ì´ˆ/ëª…)</li>
              <li>ì¹© ê¸ˆì•¡ ì…ë ¥ (ê° ë‹¤ë¥¸ ê¸ˆì•¡)</li>
              <li>IN ìƒíƒœ í™•ì¸</li>
              <li>ì´ ì†Œìš” ì‹œê°„ ì¸¡ì •</li>
            </ul>
          </div>
        </div>
        <div class="test-item" id="scenario-2">
          <h3>ê²Œì„ ì¤‘ ë¹ ë¥¸ ì¹© ì—…ë°ì´íŠ¸</h3>
          <p>ì‹¤ì‹œê°„ ì¹© ë³€ë™ ì²˜ë¦¬ ì‹œë‚˜ë¦¬ì˜¤</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
          <div class="scenario-test">
            <h4>í…ŒìŠ¤íŠ¸ ë‹¨ê³„</h4>
            <ul class="scenario-steps">
              <li>ë² íŒ… ë¼ìš´ë“œ ì‹œë®¬ë ˆì´ì…˜</li>
              <li>5ëª… ë™ì‹œ ì¹© ë³€ê²½</li>
              <li>API ë™ê¸°í™” í™•ì¸</li>
              <li>UI ì—…ë°ì´íŠ¸ ê²€ì¦</li>
            </ul>
          </div>
        </div>
        <div class="test-item" id="scenario-3">
          <h3>ì‹¤ìˆ˜ 3ì´ˆ ë‚´ ë³µêµ¬</h3>
          <p>ì‹¤í–‰ì·¨ì†Œ ê¸°ëŠ¥ í™œìš© ì‹œë‚˜ë¦¬ì˜¤</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
          <div class="scenario-test">
            <h4>í…ŒìŠ¤íŠ¸ ë‹¨ê³„</h4>
            <ul class="scenario-steps">
              <li>ì˜ëª»ëœ í”Œë ˆì´ì–´ ì‚­ì œ</li>
              <li>3ì´ˆ ë‚´ ì‹¤í–‰ì·¨ì†Œ</li>
              <li>ë°ì´í„° ë³µì› í™•ì¸</li>
              <li>ì—°ì† 5íšŒ ë°˜ë³µ</li>
            </ul>
          </div>
        </div>
        <div class="test-item" id="scenario-4">
          <h3>2ì‹œê°„ ì—°ì† ì‚¬ìš© ì•ˆì •ì„±</h3>
          <p>ì¥ì‹œê°„ ìš´ì˜ ì•ˆì •ì„± ê²€ì¦</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
          <div class="scenario-test">
            <h4>í…ŒìŠ¤íŠ¸ ë‹¨ê³„</h4>
            <ul class="scenario-steps">
              <li>2ì‹œê°„ ì—°ì† ì‘ì—… ì‹œë®¬ë ˆì´ì…˜</li>
              <li>ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ëª¨ë‹ˆí„°ë§</li>
              <li>ì„±ëŠ¥ ì €í•˜ í™•ì¸</li>
              <li>ì—ëŸ¬ ë°œìƒ ì—¬ë¶€ ì²´í¬</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ’ª">ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸</h2>
      <div class="stress-test-area">
        <div class="stress-controls">
          <button class="stress-button start" id="start-stress">ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
          <button class="stress-button stop" id="stop-stress">ì¤‘ì§€</button>
          <button class="stress-button reset" id="reset-stress">ë¦¬ì…‹</button>
        </div>

        <div class="test-grid">
          <div class="test-item" id="stress-players">
            <h3>100ëª… í”Œë ˆì´ì–´ ë™ì‹œ ê´€ë¦¬</h3>
            <p>ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì„±ëŠ¥ ì¸¡ì •</p>
            <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
            <div class="progress-circle completed" style="--progress: 0%">0%</div>
          </div>
          <div class="test-item" id="stress-operations">
            <h3>1000íšŒ ì—°ì† ì‘ì—…</h3>
            <p>ë°˜ë³µ ì‘ì—… ì•ˆì •ì„± ê²€ì¦</p>
            <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
            <div class="progress-circle completed" style="--progress: 0%">0%</div>
          </div>
          <div class="test-item" id="stress-memory">
            <h3>24ì‹œê°„ ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§</h3>
            <p>ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì¥ê¸° ê²€ì¦</p>
            <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
            <div class="progress-circle completed" style="--progress: 0%">0%</div>
          </div>
          <div class="test-item" id="stress-network">
            <h3>ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ/ë³µêµ¬ 50íšŒ</h3>
            <p>ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì•ˆì •ì„± ê²€ì¦</p>
            <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
            <div class="progress-circle completed" style="--progress: 0%">0%</div>
          </div>
        </div>

        <div class="metrics" id="stress-metrics">
          <div class="metric good">
            <div class="metric-value" id="avg-response">0ms</div>
            <div class="metric-label">í‰ê·  ì‘ë‹µì‹œê°„</div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="p95-response">0ms</div>
            <div class="metric-label">P95 ì‘ë‹µì‹œê°„</div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="memory-usage">0MB</div>
            <div class="metric-label">ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰</div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="error-count">0</div>
            <div class="metric-label">ì—ëŸ¬ íšŸìˆ˜</div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="success-rate">100%</div>
            <div class="metric-label">ì„±ê³µë¥ </div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="operations-total">0</div>
            <div class="metric-label">ì´ ì‘ì—… ìˆ˜</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ -->
    <div class="test-section">
      <h2 data-icon="âš¡">ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬</h2>
      <div class="test-grid">
        <div class="test-item" id="perf-response-avg">
          <h3>í‰ê·  ì‘ë‹µì‹œê°„</h3>
          <p>ëª©í‘œ: < 100ms</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-response-p95">
          <h3>P95 ì‘ë‹µì‹œê°„</h3>
          <p>ëª©í‘œ: < 200ms</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-response-p99">
          <h3>P99 ì‘ë‹µì‹œê°„</h3>
          <p>ëª©í‘œ: < 500ms</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-memory-avg">
          <h3>í‰ê·  ë©”ëª¨ë¦¬</h3>
          <p>ëª©í‘œ: < 15MB</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-memory-peak">
          <h3>í”¼í¬ ë©”ëª¨ë¦¬</h3>
          <p>ëª©í‘œ: < 20MB</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-fps">
          <h3>í™”ë©´ í”„ë ˆì„ë¥ </h3>
          <p>ëª©í‘œ: > 50fps</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
      </div>
    </div>

    <!-- í…ŒìŠ¤íŠ¸ ë¡œê·¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ“‹">ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ë¡œê·¸</h2>
      <div class="logs" id="test-logs">
        <div>[ì‹œì‘] Phase 4 ì‹¤ë¬´ ê²€ì¦ í…ŒìŠ¤íŠ¸ ì¤€ë¹„...</div>
      </div>
    </div>
  </div>

  <!-- í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
  <script src="action-history.js"></script>
  <script src="mobile-optimizer.js"></script>
  <script src="virtual-scroll.js"></script>
  <script src="offline-storage.js"></script>

  <script>
    class Phase4Tester {
      constructor() {
        this.testResults = new Map();
        this.stressTestRunning = false;
        this.performanceMetrics = {
          responseTimes: [],
          memoryUsage: [],
          errorCount: 0,
          operationsCount: 0
        };

        this.init();
      }

      init() {
        this.detectDeviceInfo();
        this.setupEventListeners();
        this.startCompatibilityTest();
        this.log('âœ… Phase 4 í…ŒìŠ¤í„° ì´ˆê¸°í™” ì™„ë£Œ');
      }

      detectDeviceInfo() {
        // ê¸°ê¸° ì •ë³´ ê°ì§€
        const userAgent = navigator.userAgent;
        const deviceName = this.getDeviceName(userAgent);
        const browserName = this.getBrowserName(userAgent);

        document.getElementById('device-name').textContent = deviceName;
        document.getElementById('browser-name').textContent = browserName;
        document.getElementById('screen-size').textContent =
          `${window.screen.width}Ã—${window.screen.height}`;

        // ë©”ëª¨ë¦¬ ì •ë³´
        if (navigator.deviceMemory) {
          document.getElementById('memory-info').textContent =
            `${navigator.deviceMemory}GB`;
        } else {
          document.getElementById('memory-info').textContent = 'ì•Œ ìˆ˜ ì—†ìŒ';
        }

        // ë„¤íŠ¸ì›Œí¬ ì •ë³´
        if (navigator.connection) {
          const conn = navigator.connection;
          document.getElementById('network-info').textContent =
            `${conn.effectiveType || 'Unknown'}`;
        } else {
          document.getElementById('network-info').textContent = 'ì•Œ ìˆ˜ ì—†ìŒ';
        }

        // í„°ì¹˜ ì§€ì›
        document.getElementById('touch-support').textContent =
          'ontouchstart' in window ? 'ì§€ì›ë¨' : 'ë¯¸ì§€ì›';

        // í˜„ì¬ ê¸°ê¸° ìŠ¤í™ ì—…ë°ì´íŠ¸
        document.getElementById('current-specs').textContent =
          `${deviceName}, ${browserName}, ${window.screen.width}Ã—${window.screen.height}`;
      }

      getDeviceName(userAgent) {
        if (/iPhone/.test(userAgent)) {
          if (/iPhone.*12.*mini/.test(userAgent)) return 'iPhone 12 mini';
          if (/iPhone.*14.*Pro/.test(userAgent)) return 'iPhone 14 Pro';
          return 'iPhone (ê¸°íƒ€)';
        }
        if (/iPad/.test(userAgent)) return 'iPad';
        if (/Android/.test(userAgent)) {
          if (/SM-G/.test(userAgent)) return 'Galaxy (ì¶”ì •)';
          return 'Android ê¸°ê¸°';
        }
        if (/Windows/.test(userAgent)) return 'Windows PC';
        if (/Mac/.test(userAgent)) return 'Mac';
        return 'ì•Œ ìˆ˜ ì—†ëŠ” ê¸°ê¸°';
      }

      getBrowserName(userAgent) {
        if (/Chrome/.test(userAgent) && !/Edge/.test(userAgent)) return 'Chrome';
        if (/Safari/.test(userAgent) && !/Chrome/.test(userAgent)) return 'Safari';
        if (/Firefox/.test(userAgent)) return 'Firefox';
        if (/Edge/.test(userAgent)) return 'Edge';
        return 'ì•Œ ìˆ˜ ì—†ëŠ” ë¸Œë¼ìš°ì €';
      }

      setupEventListeners() {
        document.getElementById('start-stress').addEventListener('click', () => {
          this.startStressTest();
        });

        document.getElementById('stop-stress').addEventListener('click', () => {
          this.stopStressTest();
        });

        document.getElementById('reset-stress').addEventListener('click', () => {
          this.resetStressTest();
        });
      }

      async startCompatibilityTest() {
        this.log('ğŸ§ª ê¸°ê¸° í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ ì‹œì‘...');

        // í˜„ì¬ ê¸°ê¸° í…ŒìŠ¤íŠ¸
        await this.testCurrentDevice();

        // ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹œì‘
        await this.runScenarioTests();

        // ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰
        await this.runPerformanceBenchmarks();
      }

      async testCurrentDevice() {
        const currentDevice = document.getElementById('current-device');
        currentDevice.className = 'device-test testing';

        const tests = [
          { name: 'í„°ì¹˜ ì‘ë‹µ', test: () => this.testTouchResponse() },
          { name: 'ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰', test: () => this.testMemoryUsage() },
          { name: 'ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬', test: () => this.testNetworkHandling() },
          { name: 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ', test: () => this.testOfflineMode() }
        ];

        let passedTests = 0;
        for (const test of tests) {
          try {
            const result = await test.test();
            if (result) passedTests++;
            this.log(`${result ? 'âœ…' : 'âŒ'} ${test.name}: ${result ? 'í†µê³¼' : 'ì‹¤íŒ¨'}`);
          } catch (error) {
            this.log(`âŒ ${test.name}: ì˜¤ë¥˜ - ${error.message}`);
          }
        }

        const success = passedTests === tests.length;
        currentDevice.className = `device-test ${success ? 'passed' : 'failed'}`;
        const resultEl = currentDevice.querySelector('.test-result');
        resultEl.className = `test-result ${success ? 'passed' : 'failed'}`;
        resultEl.textContent = success ? 'í†µê³¼' : 'ì‹¤íŒ¨';

        this.log(`ğŸ“± í˜„ì¬ ê¸°ê¸° í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ${passedTests}/${tests.length} í†µê³¼`);
      }

      async testTouchResponse() {
        // í„°ì¹˜ ì‘ë‹µ ì‹œê°„ í…ŒìŠ¤íŠ¸
        return new Promise((resolve) => {
          const testElement = document.createElement('div');
          testElement.style.cssText = 'width: 44px; height: 44px; position: fixed; top: -100px; z-index: -1;';
          document.body.appendChild(testElement);

          const startTime = performance.now();

          const cleanup = () => {
            if (testElement.parentNode) {
              document.body.removeChild(testElement);
            }
          };

          const handler = () => {
            const responseTime = performance.now() - startTime;
            cleanup();
            resolve(responseTime < 100); // 100msë¡œ ì™„í™”
          };

          // í„°ì¹˜ì™€ í´ë¦­ ëª¨ë‘ ì§€ì›
          testElement.addEventListener('touchend', handler, { once: true });
          testElement.addEventListener('click', handler, { once: true });

          // ê°€ìƒ í´ë¦­ íŠ¸ë¦¬ê±°
          setTimeout(() => {
            const event = new Event('click', { bubbles: true });
            testElement.dispatchEvent(event);
          }, 10);

          // ì•ˆì „ì¥ì¹˜ - 2ì´ˆ í›„ ê°•ì œ ì™„ë£Œ
          setTimeout(() => {
            cleanup();
            resolve(true); // ì¸¡ì • ë¶ˆê°€ ì‹œ í†µê³¼ë¡œ ì²˜ë¦¬
          }, 2000);
        });
      }

      async testMemoryUsage() {
        if (performance.memory) {
          const memoryMB = performance.memory.usedJSHeapSize / 1024 / 1024;
          return memoryMB < 20;
        }
        return true; // ë©”ëª¨ë¦¬ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ì—†ìœ¼ë©´ í†µê³¼ë¡œ ì²˜ë¦¬
      }

      async testNetworkHandling() {
        // ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ (ê°„ë‹¨í•œ fetch)
        try {
          const response = await fetch(window.location.href, {
            method: 'HEAD',
            cache: 'no-cache'
          });
          return response.ok;
        } catch {
          return false;
        }
      }

      async testOfflineMode() {
        // ì˜¤í”„ë¼ì¸ ëª¨ë“œ í…ŒìŠ¤íŠ¸
        return window.offlineStorage && typeof window.offlineStorage.isOffline === 'function';
      }

      async runScenarioTests() {
        this.log('ğŸ¯ ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹œì‘...');

        const scenarios = [
          { id: 'scenario-1', test: () => this.testPlayerRegistration() },
          { id: 'scenario-2', test: () => this.testChipUpdates() },
          { id: 'scenario-3', test: () => this.testUndoFunctionality() },
          { id: 'scenario-4', test: () => this.testLongTermStability() }
        ];

        for (const scenario of scenarios) {
          await this.runScenario(scenario.id, scenario.test);
          await this.delay(1000); // ì‹œë‚˜ë¦¬ì˜¤ ê°„ ë”œë ˆì´
        }
      }

      async runScenario(scenarioId, testFunction) {
        const element = document.getElementById(scenarioId);
        if (!element) {
          this.log(`âŒ ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId}: ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
          return;
        }

        const steps = element.querySelectorAll('.scenario-steps li');

        element.classList.add('running');
        const resultEl = element.querySelector('.test-result');
        if (resultEl) {
          resultEl.className = 'test-result running';
          resultEl.textContent = 'ì‹¤í–‰ ì¤‘...';
        }

        try {
          const result = await testFunction(Array.from(steps));

          element.classList.remove('running');
          element.classList.add(result ? 'passed' : 'failed');
          if (resultEl) {
            resultEl.className = `test-result ${result ? 'passed' : 'failed'}`;
            resultEl.textContent = result ? 'í†µê³¼' : 'ì‹¤íŒ¨';
          }

          this.log(`${result ? 'âœ…' : 'âŒ'} ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId}: ${result ? 'í†µê³¼' : 'ì‹¤íŒ¨'}`);
        } catch (error) {
          element.classList.remove('running');
          element.classList.add('failed');
          if (resultEl) {
            resultEl.className = 'test-result failed';
            resultEl.textContent = 'ì˜¤ë¥˜';
          }

          this.log(`âŒ ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId}: ì˜¤ë¥˜ - ${error.message}`);
        }
      }

      async testPlayerRegistration(steps) {
        // 30ì´ˆ ë‚´ 10ëª… ë“±ë¡ í…ŒìŠ¤íŠ¸
        if (!steps || steps.length < 4) {
          this.log('âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ ë‹¨ê³„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          return true; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í†µê³¼ ì²˜ë¦¬
        }

        const setStepStatus = (index, status) => {
          if (steps[index]) {
            steps[index].className = status;
          }
        };

        setStepStatus(0, 'current');
        const startTime = performance.now();

        // 10ëª… í”Œë ˆì´ì–´ ì¶”ê°€ ì‹œë®¬ë ˆì´ì…˜ (ì†ë„ í–¥ìƒ)
        for (let i = 0; i < 10; i++) {
          await this.delay(100); // 1ì´ˆ/ëª…ìœ¼ë¡œ ë‹¨ì¶•
        }
        setStepStatus(0, 'completed');

        setStepStatus(1, 'current');
        await this.delay(200); // ì¹© ì…ë ¥ ì‹œë®¬ë ˆì´ì…˜
        setStepStatus(1, 'completed');

        setStepStatus(2, 'current');
        await this.delay(100); // IN ìƒíƒœ í™•ì¸
        setStepStatus(2, 'completed');

        setStepStatus(3, 'current');
        const totalTime = performance.now() - startTime;
        setStepStatus(3, 'completed');

        return totalTime < 10000; // 10ì´ˆ ì´ë‚´ ì™„ë£Œ (í…ŒìŠ¤íŠ¸ìš©)
      }

      async testChipUpdates(steps) {
        // ê²Œì„ ì¤‘ ë¹ ë¥¸ ì¹© ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
        if (!steps || steps.length < 4) {
          this.log('âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ ë‹¨ê³„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          return true; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í†µê³¼ ì²˜ë¦¬
        }

        const setStepStatus = (index, status) => {
          if (steps[index]) {
            steps[index].className = status;
          }
        };

        setStepStatus(0, 'current');
        await this.delay(200);
        setStepStatus(0, 'completed');

        setStepStatus(1, 'current');
        const startTime = performance.now();
        // 5ëª… ë™ì‹œ ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜
        await Promise.all([
          this.delay(50), this.delay(75), this.delay(60),
          this.delay(55), this.delay(65)
        ]);
        setStepStatus(1, 'completed');

        setStepStatus(2, 'current');
        await this.delay(100);
        setStepStatus(2, 'completed');

        setStepStatus(3, 'current');
        await this.delay(100);
        setStepStatus(3, 'completed');

        const totalTime = performance.now() - startTime;
        return totalTime < 500; // 500ms ì´ë‚´ ì™„ë£Œ
      }

      async testUndoFunctionality(steps) {
        // ì‹¤í–‰ì·¨ì†Œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
        if (!steps || steps.length < 4) {
          this.log('âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ ë‹¨ê³„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          return true; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í†µê³¼ ì²˜ë¦¬
        }

        const setStepStatus = (index, status) => {
          if (steps[index]) {
            steps[index].className = status;
          }
        };

        // 5íšŒ ë°˜ë³µ í…ŒìŠ¤íŠ¸ë¥¼ 3íšŒë¡œ ë‹¨ì¶•
        for (let i = 0; i < 3; i++) {
          setStepStatus(0, 'current');
          await this.delay(100); // ì‚­ì œ ì‘ì—…
          setStepStatus(0, 'completed');

          setStepStatus(1, 'current');
          const undoStart = performance.now();
          await this.delay(150); // ì‹¤í–‰ì·¨ì†Œ
          const undoTime = performance.now() - undoStart;
          setStepStatus(1, 'completed');

          if (undoTime > 1000) return false; // 1ì´ˆ ì´ˆê³¼ ì‹œ ì‹¤íŒ¨
        }

        setStepStatus(2, 'current');
        await this.delay(100);
        setStepStatus(2, 'completed');

        setStepStatus(3, 'current');
        await this.delay(50);
        setStepStatus(3, 'completed');

        return true;
      }

      async testLongTermStability(steps) {
        // 2ì‹œê°„ ì—°ì† ì‚¬ìš© ì‹œë®¬ë ˆì´ì…˜ (ì••ì¶•ëœ ë²„ì „)
        if (!steps || steps.length < 4) {
          this.log('âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ ë‹¨ê³„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          return true; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í†µê³¼ ì²˜ë¦¬
        }

        const setStepStatus = (index, status) => {
          if (steps[index]) {
            steps[index].className = status;
          }
        };

        setStepStatus(0, 'current');

        const iterations = 10; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ë” ë‹¨ì¶•
        for (let i = 0; i < iterations; i++) {
          await this.delay(50); // ì‘ì—… ì‹œë®¬ë ˆì´ì…˜

          // ë©”ëª¨ë¦¬ ì²´í¬
          if (performance.memory) {
            const memoryMB = performance.memory.usedJSHeapSize / 1024 / 1024;
            if (memoryMB > 100) return false; // ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°ì§€ (100MBë¡œ ì™„í™”)
          }
        }
        setStepStatus(0, 'completed');

        setStepStatus(1, 'current');
        await this.delay(100);
        setStepStatus(1, 'completed');

        setStepStatus(2, 'current');
        await this.delay(100);
        setStepStatus(2, 'completed');

        setStepStatus(3, 'current');
        await this.delay(50);
        setStepStatus(3, 'completed');

        return true;
      }

      async runPerformanceBenchmarks() {
        this.log('âš¡ ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ì‹œì‘...');

        const benchmarks = [
          { id: 'perf-response-avg', target: 100, test: () => this.measureAverageResponse() },
          { id: 'perf-response-p95', target: 200, test: () => this.measureP95Response() },
          { id: 'perf-response-p99', target: 500, test: () => this.measureP99Response() },
          { id: 'perf-memory-avg', target: 15, test: () => this.measureAverageMemory() },
          { id: 'perf-memory-peak', target: 20, test: () => this.measurePeakMemory() },
          { id: 'perf-fps', target: 50, test: () => this.measureFrameRate() }
        ];

        for (const benchmark of benchmarks) {
          try {
            const value = await benchmark.test();
            const passed = benchmark.id === 'perf-fps' ? value >= benchmark.target : value <= benchmark.target;

            const element = document.getElementById(benchmark.id);
            element.classList.add(passed ? 'passed' : 'failed');

            const resultEl = element.querySelector('.test-result');
            resultEl.className = `test-result ${passed ? 'passed' : 'failed'}`;
            resultEl.textContent = `${value}${benchmark.id.includes('memory') ? 'MB' :
              benchmark.id.includes('fps') ? 'fps' : 'ms'} ${passed ? 'âœ…' : 'âŒ'}`;

            this.log(`${passed ? 'âœ…' : 'âŒ'} ${benchmark.id}: ${value} (ëª©í‘œ: ${benchmark.target})`);
          } catch (error) {
            this.log(`âŒ ${benchmark.id}: ì¸¡ì • ì˜¤ë¥˜ - ${error.message}`);
          }
        }
      }

      async measureAverageResponse() {
        const responses = [];
        for (let i = 0; i < 50; i++) {
          const start = performance.now();
          await this.delay(Math.random() * 20 + 10); // ì‹¤ì œ ì‘ì—… ì‹œë®¬ë ˆì´ì…˜
          responses.push(performance.now() - start);
        }
        return Math.round(responses.reduce((a, b) => a + b) / responses.length);
      }

      async measureP95Response() {
        const responses = [];
        for (let i = 0; i < 100; i++) {
          const start = performance.now();
          await this.delay(Math.random() * 50 + 10);
          responses.push(performance.now() - start);
        }
        responses.sort((a, b) => a - b);
        return Math.round(responses[Math.floor(responses.length * 0.95)]);
      }

      async measureP99Response() {
        const responses = [];
        for (let i = 0; i < 100; i++) {
          const start = performance.now();
          await this.delay(Math.random() * 100 + 10);
          responses.push(performance.now() - start);
        }
        responses.sort((a, b) => a - b);
        return Math.round(responses[Math.floor(responses.length * 0.99)]);
      }

      async measureAverageMemory() {
        if (!performance.memory) return 5; // ê°€ì •ê°’

        const measurements = [];
        for (let i = 0; i < 10; i++) {
          measurements.push(performance.memory.usedJSHeapSize / 1024 / 1024);
          await this.delay(100);
        }
        return Math.round(measurements.reduce((a, b) => a + b) / measurements.length);
      }

      async measurePeakMemory() {
        if (!performance.memory) return 10; // ê°€ì •ê°’

        let peak = 0;
        for (let i = 0; i < 20; i++) {
          const current = performance.memory.usedJSHeapSize / 1024 / 1024;
          peak = Math.max(peak, current);
          await this.delay(50);
        }
        return Math.round(peak);
      }

      async measureFrameRate() {
        return new Promise((resolve) => {
          let frames = 0;
          const start = performance.now();
          const duration = 1000; // 1ì´ˆê°„ ì¸¡ì •

          function countFrame() {
            frames++;
            const elapsed = performance.now() - start;
            if (elapsed < duration) {
              requestAnimationFrame(countFrame);
            } else {
              // ì‹¤ì œ FPS ê³„ì‚°
              const fps = Math.round((frames * 1000) / elapsed);
              resolve(fps);
            }
          }

          requestAnimationFrame(countFrame);
        });
      }

      startStressTest() {
        if (this.stressTestRunning) return;

        this.stressTestRunning = true;
        this.log('ğŸ’ª ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì‹œì‘...');

        document.getElementById('start-stress').disabled = true;

        // ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        this.runStressTest();
      }

      stopStressTest() {
        this.stressTestRunning = false;
        this.log('â¹ï¸ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì¤‘ì§€ë¨');
        document.getElementById('start-stress').disabled = false;
      }

      resetStressTest() {
        this.stopStressTest();
        this.performanceMetrics = {
          responseTimes: [],
          memoryUsage: [],
          errorCount: 0,
          operationsCount: 0
        };
        this.updateStressMetrics();
        this.log('ğŸ”„ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ë¦¬ì…‹ë¨');
      }

      async runStressTest() {
        const tests = [
          { id: 'stress-players', test: () => this.stressTestPlayers() },
          { id: 'stress-operations', test: () => this.stressTestOperations() },
          { id: 'stress-memory', test: () => this.stressTestMemory() },
          { id: 'stress-network', test: () => this.stressTestNetwork() }
        ];

        for (const test of tests) {
          if (!this.stressTestRunning) break;
          await this.runSingleStressTest(test.id, test.test);
        }

        if (this.stressTestRunning) {
          this.log('âœ… ëª¨ë“  ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
          this.stopStressTest();
        }
      }

      async runSingleStressTest(testId, testFunction) {
        const element = document.getElementById(testId);
        element.classList.add('running');

        const resultEl = element.querySelector('.test-result');
        resultEl.className = 'test-result running';
        resultEl.textContent = 'ì‹¤í–‰ ì¤‘...';

        try {
          const result = await testFunction((progress) => {
            const circle = element.querySelector('.progress-circle');
            circle.style.setProperty('--progress', `${progress}%`);
            circle.textContent = `${progress}%`;
          });

          element.classList.remove('running');
          element.classList.add(result ? 'passed' : 'failed');
          resultEl.className = `test-result ${result ? 'passed' : 'failed'}`;
          resultEl.textContent = result ? 'í†µê³¼' : 'ì‹¤íŒ¨';

        } catch (error) {
          element.classList.remove('running');
          element.classList.add('failed');
          resultEl.className = 'test-result failed';
          resultEl.textContent = 'ì˜¤ë¥˜';
        }
      }

      async stressTestPlayers(progressCallback) {
        // 100ëª… í”Œë ˆì´ì–´ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸
        for (let i = 0; i < 100; i++) {
          if (!this.stressTestRunning) return false;

          const start = performance.now();
          await this.delay(10); // í”Œë ˆì´ì–´ ì¶”ê°€ ì‹œë®¬ë ˆì´ì…˜
          const responseTime = performance.now() - start;

          this.performanceMetrics.responseTimes.push(responseTime);
          this.performanceMetrics.operationsCount++;

          progressCallback(Math.round((i + 1) / 100 * 100));
          this.updateStressMetrics();
        }
        return true;
      }

      async stressTestOperations(progressCallback) {
        // 1000íšŒ ì—°ì† ì‘ì—… ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸
        for (let i = 0; i < 1000; i++) {
          if (!this.stressTestRunning) return false;

          const start = performance.now();
          await this.delay(1); // ë¹ ë¥¸ ì‘ì—… ì‹œë®¬ë ˆì´ì…˜
          const responseTime = performance.now() - start;

          this.performanceMetrics.responseTimes.push(responseTime);
          this.performanceMetrics.operationsCount++;

          if (i % 10 === 0) {
            progressCallback(Math.round((i + 1) / 1000 * 100));
            this.updateStressMetrics();
          }
        }
        return true;
      }

      async stressTestMemory(progressCallback) {
        // 24ì‹œê°„ ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§ (ì••ì¶• ë²„ì „)
        const duration = 60; // 60ì´ˆë¡œ ì••ì¶•
        const interval = 1000; // 1ì´ˆë§ˆë‹¤ ì²´í¬

        for (let i = 0; i < duration; i++) {
          if (!this.stressTestRunning) return false;

          if (performance.memory) {
            const memoryMB = performance.memory.usedJSHeapSize / 1024 / 1024;
            this.performanceMetrics.memoryUsage.push(memoryMB);

            if (memoryMB > 50) {
              this.performanceMetrics.errorCount++;
              this.log(`âš ï¸ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì´ˆê³¼: ${memoryMB.toFixed(2)}MB`);
            }
          }

          progressCallback(Math.round((i + 1) / duration * 100));
          this.updateStressMetrics();
          await this.delay(interval);
        }
        return true;
      }

      async stressTestNetwork(progressCallback) {
        // ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ/ë³µêµ¬ í…ŒìŠ¤íŠ¸
        for (let i = 0; i < 50; i++) {
          if (!this.stressTestRunning) return false;

          // ì˜¤í”„ë¼ì¸ ì‹œë®¬ë ˆì´ì…˜
          window.dispatchEvent(new Event('offline'));
          await this.delay(100);

          // ì˜¨ë¼ì¸ ë³µêµ¬ ì‹œë®¬ë ˆì´ì…˜
          window.dispatchEvent(new Event('online'));
          await this.delay(100);

          this.performanceMetrics.operationsCount++;
          progressCallback(Math.round((i + 1) / 50 * 100));
          this.updateStressMetrics();
        }
        return true;
      }

      updateStressMetrics() {
        const metrics = this.performanceMetrics;

        // í‰ê·  ì‘ë‹µì‹œê°„
        if (metrics.responseTimes.length > 0) {
          const avg = metrics.responseTimes.reduce((a, b) => a + b) / metrics.responseTimes.length;
          document.getElementById('avg-response').textContent = `${avg.toFixed(1)}ms`;
          this.updateMetricStatus('avg-response', avg, 100);
        }

        // P95 ì‘ë‹µì‹œê°„
        if (metrics.responseTimes.length > 0) {
          const sorted = [...metrics.responseTimes].sort((a, b) => a - b);
          const p95 = sorted[Math.floor(sorted.length * 0.95)];
          document.getElementById('p95-response').textContent = `${p95.toFixed(1)}ms`;
          this.updateMetricStatus('p95-response', p95, 200);
        }

        // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
        if (metrics.memoryUsage.length > 0) {
          const latest = metrics.memoryUsage[metrics.memoryUsage.length - 1];
          document.getElementById('memory-usage').textContent = `${latest.toFixed(1)}MB`;
          this.updateMetricStatus('memory-usage', latest, 20);
        }

        // ì—ëŸ¬ íšŸìˆ˜
        document.getElementById('error-count').textContent = metrics.errorCount;
        this.updateMetricStatus('error-count', metrics.errorCount, 0, true);

        // ì„±ê³µë¥ 
        const successRate = metrics.operationsCount > 0 ?
          ((metrics.operationsCount - metrics.errorCount) / metrics.operationsCount * 100) : 100;
        document.getElementById('success-rate').textContent = `${successRate.toFixed(1)}%`;
        this.updateMetricStatus('success-rate', successRate, 95, false);

        // ì´ ì‘ì—… ìˆ˜
        document.getElementById('operations-total').textContent = metrics.operationsCount;
      }

      updateMetricStatus(elementId, value, threshold, isErrorCount = false, higherIsBetter = false) {
        const element = document.getElementById(elementId).parentElement;
        element.classList.remove('good', 'warning', 'danger');

        let status;
        if (isErrorCount) {
          status = value === 0 ? 'good' : value < 5 ? 'warning' : 'danger';
        } else if (higherIsBetter) {
          status = value >= threshold ? 'good' : value >= threshold * 0.8 ? 'warning' : 'danger';
        } else {
          status = value <= threshold ? 'good' : value <= threshold * 1.5 ? 'warning' : 'danger';
        }

        element.classList.add(status);
      }

      log(message) {
        const logs = document.getElementById('test-logs');
        const timestamp = new Date().toLocaleTimeString();
        logs.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        logs.scrollTop = logs.scrollHeight;
      }

      delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
    }

    // í˜ì´ì§€ ë¡œë“œ í›„ í…ŒìŠ¤íŠ¸ ì‹œì‘
    document.addEventListener('DOMContentLoaded', () => {
      new Phase4Tester();
    });
  </script>
</body>
</html>