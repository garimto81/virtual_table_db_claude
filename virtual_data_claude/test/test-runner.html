<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apps Script v62 ë¡œì»¬ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn-tailwindcss.vercel.app/"></script>
    <style>
        .console-output {
            background: #1e1e1e;
            color: #f0f0f0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 15px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .test-section {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
        .warning { color: #f59e0b; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-6">
        <h1 class="text-3xl font-bold text-center mb-8">
            ğŸ§ª Apps Script v62 ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½
        </h1>

        <!-- í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤ -->
        <div class="test-section bg-white">
            <h2 class="text-xl font-semibold mb-4">ğŸ® í…ŒìŠ¤íŠ¸ ì‹¤í–‰</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button onclick="runBasicTests()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
                </button>
                <button onclick="runBatchUpdateTest()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    ì¼ê´„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
                </button>
                <button onclick="runDeleteTest()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    ì‚­ì œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
                </button>
                <button onclick="runSortTest()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    ì •ë ¬ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
                </button>
            </div>
            <div class="mt-4">
                <button onclick="clearOutput()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    ì¶œë ¥ ì§€ìš°ê¸°
                </button>
                <button onclick="printCurrentData()" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                    í˜„ì¬ ë°ì´í„° ì¶œë ¥
                </button>
                <button onclick="resetTestData()" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600">
                    í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¦¬ì…‹
                </button>
            </div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì¶œë ¥ -->
        <div class="test-section bg-white">
            <h2 class="text-xl font-semibold mb-4">ğŸ“‹ í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
            <div id="test-output" class="console-output">
                í…ŒìŠ¤íŠ¸ ì¶œë ¥ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
            </div>
        </div>

        <!-- í˜„ì¬ ë°ì´í„° í‘œì‹œ -->
        <div class="test-section bg-white">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š í˜„ì¬ Type ì‹œíŠ¸ ë°ì´í„°</h2>
            <div id="data-display" class="overflow-x-auto">
                <table class="min-w-full table-auto border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-300 px-4 py-2">í–‰</th>
                            <th class="border border-gray-300 px-4 py-2">Camera</th>
                            <th class="border border-gray-300 px-4 py-2">Player</th>
                            <th class="border border-gray-300 px-4 py-2">Table</th>
                            <th class="border border-gray-300 px-4 py-2">Notable</th>
                            <th class="border border-gray-300 px-4 py-2">Chips</th>
                            <th class="border border-gray-300 px-4 py-2">UpdatedAt</th>
                            <th class="border border-gray-300 px-4 py-2">Seat</th>
                            <th class="border border-gray-300 px-4 py-2">Status</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-body">
                        <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ëŒ€í™”í˜• í…ŒìŠ¤íŠ¸ -->
        <div class="test-section bg-white">
            <h2 class="text-xl font-semibold mb-4">ğŸ”§ ëŒ€í™”í˜• í…ŒìŠ¤íŠ¸</h2>
            <div class="space-y-4">
                <!-- í”Œë ˆì´ì–´ ì¶”ê°€ -->
                <div class="p-4 bg-blue-50 rounded">
                    <h3 class="font-semibold mb-2">í”Œë ˆì´ì–´ ì¶”ê°€</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                        <input type="text" id="add-player-name" placeholder="í”Œë ˆì´ì–´ ì´ë¦„" class="border rounded px-2 py-1">
                        <input type="text" id="add-player-table" placeholder="í…Œì´ë¸”" class="border rounded px-2 py-1">
                        <input type="number" id="add-player-seat" placeholder="ì¢Œì„" class="border rounded px-2 py-1">
                        <input type="number" id="add-player-chips" placeholder="ì¹©" class="border rounded px-2 py-1">
                    </div>
                    <button onclick="addPlayerInteractive()" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        í”Œë ˆì´ì–´ ì¶”ê°€
                    </button>
                </div>

                <!-- í”Œë ˆì´ì–´ ì‚­ì œ -->
                <div class="p-4 bg-red-50 rounded">
                    <h3 class="font-semibold mb-2">í”Œë ˆì´ì–´ ì‚­ì œ</h3>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="text" id="delete-player-name" placeholder="í”Œë ˆì´ì–´ ì´ë¦„" class="border rounded px-2 py-1">
                        <input type="text" id="delete-player-table" placeholder="í…Œì´ë¸”" class="border rounded px-2 py-1">
                    </div>
                    <button onclick="deletePlayerInteractive()" class="mt-2 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                        í”Œë ˆì´ì–´ ì‚­ì œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mock í™˜ê²½ ë° Apps Script ë¡œë“œ -->
    <script src="mock-apps-script.js"></script>
    <script src="local-apps-script.js"></script>

    <script>
        // ì½˜ì†” ì¶œë ¥ì„ ì›¹í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;

        let outputBuffer = [];

        function logToPage(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'error' : type === 'warning' ? 'warning' : type === 'success' ? 'success' : 'info';
            outputBuffer.push(`<span class="${colorClass}">[${timestamp}] ${message}</span>`);

            const outputElement = document.getElementById('test-output');
            if (outputElement) {
                outputElement.innerHTML = outputBuffer.join('\n');
                outputElement.scrollTop = outputElement.scrollHeight;
            }
        }

        console.log = function(...args) {
            const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)).join(' ');
            logToPage(message, 'info');
            originalConsoleLog.apply(console, args);
        };

        console.error = function(...args) {
            const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)).join(' ');
            logToPage(message, 'error');
            originalConsoleError.apply(console, args);
        };

        console.warn = function(...args) {
            const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)).join(' ');
            logToPage(message, 'warning');
            originalConsoleWarn.apply(console, args);
        };

        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        function clearOutput() {
            outputBuffer = [];
            document.getElementById('test-output').innerHTML = 'ì¶œë ¥ì´ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.';
        }

        function resetTestData() {
            console.log('=== í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¦¬ì…‹ ===');
            TestUtils.resetTestData();
            console.log('í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            updateDataDisplay();
        }

        function printCurrentData() {
            console.log('=== í˜„ì¬ Type ì‹œíŠ¸ ë°ì´í„° ===');
            TestUtils.printSheetData('Type');
            updateDataDisplay();
        }

        function updateDataDisplay() {
            const data = TestUtils.getSheetData('Type');
            const tbody = document.getElementById('data-table-body');

            tbody.innerHTML = '';

            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = index === 0 ? 'bg-gray-100 font-semibold' : index % 2 === 0 ? 'bg-gray-50' : '';

                const rowCell = document.createElement('td');
                rowCell.className = 'border border-gray-300 px-4 py-2 text-center';
                rowCell.textContent = index + 1;
                tr.appendChild(rowCell);

                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.className = 'border border-gray-300 px-4 py-2';
                    td.textContent = cell instanceof Date ? cell.toLocaleString() : String(cell);
                    tr.appendChild(td);
                });

                tbody.appendChild(tr);
            });
        }

        function runBasicTests() {
            console.log('ğŸ§ª ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘');

            try {
                // 1. í…Œì´ë¸” ëª©ë¡ ì¡°íšŒ
                console.log('\n1ï¸âƒ£ í…Œì´ë¸” ëª©ë¡ ì¡°íšŒ í…ŒìŠ¤íŠ¸');
                const tableList = getTableList();
                console.log('ê²°ê³¼:', tableList);

                // 2. íŠ¹ì • í…Œì´ë¸” í”Œë ˆì´ì–´ ì¡°íšŒ
                console.log('\n2ï¸âƒ£ Table1 í”Œë ˆì´ì–´ ì¡°íšŒ í…ŒìŠ¤íŠ¸');
                const players = getPlayersByTable('Table1');
                console.log('ê²°ê³¼:', players);

                // 3. ìƒˆ í”Œë ˆì´ì–´ ì¶”ê°€
                console.log('\n3ï¸âƒ£ ìƒˆ í”Œë ˆì´ì–´ ì¶”ê°€ í…ŒìŠ¤íŠ¸');
                const addResult = addPlayer({
                    name: 'TestPlayer',
                    table: 'TestTable',
                    seat: 5,
                    chips: 50000
                });
                console.log('ê²°ê³¼:', addResult);

                console.log('\nâœ… ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
                updateDataDisplay();

            } catch (error) {
                console.error('âŒ ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }

        function runBatchUpdateTest() {
            console.log('ğŸ§ª ì¼ê´„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸ ì‹œì‘');

            try {
                const players = [
                    { name: 'BatchPlayer1', seat: 1, chips: 10000, notable: false },
                    { name: 'BatchPlayer2', seat: 2, chips: 15000, notable: true },
                    { name: 'BatchPlayer3', seat: 3, chips: 8000, notable: false }
                ];

                const deleted = ['Player4']; // OUT ìƒíƒœ í”Œë ˆì´ì–´ ì‚­ì œ

                console.log('ì¼ê´„ ì—…ë°ì´íŠ¸ ìš”ì²­ ë°ì´í„°:');
                console.log('í”Œë ˆì´ì–´:', players);
                console.log('ì‚­ì œ ëŒ€ìƒ:', deleted);

                const result = batchUpdatePlayers('TestBatch', players, deleted);
                console.log('ì¼ê´„ ì—…ë°ì´íŠ¸ ê²°ê³¼:', result);

                console.log('\nâœ… ì¼ê´„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
                updateDataDisplay();

            } catch (error) {
                console.error('âŒ ì¼ê´„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }

        function runDeleteTest() {
            console.log('ğŸ§ª ì‚­ì œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘');

            try {
                // ë¨¼ì € ì‚­ì œí•  í”Œë ˆì´ì–´ ì¶”ê°€
                console.log('1ï¸âƒ£ ì‚­ì œí•  í”Œë ˆì´ì–´ ì¶”ê°€');
                const addResult = addPlayer({
                    name: 'DeleteMe',
                    table: 'DeleteTest',
                    seat: 1,
                    chips: 1000
                });
                console.log('ì¶”ê°€ ê²°ê³¼:', addResult);

                // í”Œë ˆì´ì–´ ì‚­ì œ
                console.log('\n2ï¸âƒ£ í”Œë ˆì´ì–´ ì‚­ì œ');
                const deleteResult = deletePlayer('DeleteMe', 'DeleteTest');
                console.log('ì‚­ì œ ê²°ê³¼:', deleteResult);

                console.log('\nâœ… ì‚­ì œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
                updateDataDisplay();

            } catch (error) {
                console.error('âŒ ì‚­ì œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }

        function runSortTest() {
            console.log('ğŸ§ª ì •ë ¬ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘');

            try {
                // ì •ë ¬ ì „ ë°ì´í„° í™•ì¸
                console.log('ì •ë ¬ ì „ ë°ì´í„°:');
                TestUtils.printSheetData('Type');

                // ì •ë ¬ ì‹¤í–‰
                console.log('\nì •ë ¬ ì‹¤í–‰...');
                const sortResult = sortTypeSheet();
                console.log('ì •ë ¬ ê²°ê³¼:', sortResult ? 'ì„±ê³µ' : 'ì‹¤íŒ¨');

                // ì •ë ¬ í›„ ë°ì´í„° í™•ì¸
                console.log('\nì •ë ¬ í›„ ë°ì´í„°:');
                TestUtils.printSheetData('Type');

                console.log('\nâœ… ì •ë ¬ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
                updateDataDisplay();

            } catch (error) {
                console.error('âŒ ì •ë ¬ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }

        function addPlayerInteractive() {
            const name = document.getElementById('add-player-name').value;
            const table = document.getElementById('add-player-table').value;
            const seat = document.getElementById('add-player-seat').value;
            const chips = document.getElementById('add-player-chips').value;

            if (!name || !table) {
                console.error('í”Œë ˆì´ì–´ ì´ë¦„ê³¼ í…Œì´ë¸”ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
                return;
            }

            console.log(`ğŸ”§ ëŒ€í™”í˜• í”Œë ˆì´ì–´ ì¶”ê°€: ${name}`);
            const result = addPlayer({
                name: name,
                table: table,
                seat: seat ? parseInt(seat) : null,
                chips: chips ? parseInt(chips) : 0
            });

            console.log('ì¶”ê°€ ê²°ê³¼:', result);
            updateDataDisplay();

            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('add-player-name').value = '';
            document.getElementById('add-player-table').value = '';
            document.getElementById('add-player-seat').value = '';
            document.getElementById('add-player-chips').value = '';
        }

        function deletePlayerInteractive() {
            const name = document.getElementById('delete-player-name').value;
            const table = document.getElementById('delete-player-table').value;

            if (!name || !table) {
                console.error('í”Œë ˆì´ì–´ ì´ë¦„ê³¼ í…Œì´ë¸”ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
                return;
            }

            console.log(`ğŸ”§ ëŒ€í™”í˜• í”Œë ˆì´ì–´ ì‚­ì œ: ${name}`);
            const result = deletePlayer(name, table);

            console.log('ì‚­ì œ ê²°ê³¼:', result);
            updateDataDisplay();

            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('delete-player-name').value = '';
            document.getElementById('delete-player-table').value = '';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°ì´í„° í‘œì‹œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Apps Script v62 ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!');
            console.log('ì™¼ìª½ ë²„íŠ¼ë“¤ì„ í´ë¦­í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”.');
            updateDataDisplay();
        });
    </script>
</body>
</html>