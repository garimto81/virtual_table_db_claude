<!DOCTYPE html>
<!--
  ============================================
  í¬ì»¤ í•¸ë“œ ë¡œê±° with AI ì¹© ë¶„ì„ (Poker Hand Logger with AI Chip Analysis)
  Version: 2.2.0
  Last Modified: 2025-01-05
  
  New Features:
  - ì¹© ì»¬ëŸ¬ ë“±ë¡ ì‹œìŠ¤í…œ (ìµœëŒ€ 5ê°œ)
  - AI ê¸°ë°˜ ì¹© ìŠ¤íƒ ë¶„ì„ (Gemini API)
  - ë‹¤ì¤‘ ì‚¬ì§„ ì´¬ì˜ ë° ë¶„ì„
  ============================================
-->
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" />
  <title>í¬ì»¤ í•¸ë“œ ë¡œê±° v2.2.0 (AI ì¹© ë¶„ì„)</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@700&family=Noto+Sans+KR:wght@400;500;700&display=swap');
    html, body { height: 100vh; overflow: hidden; font-family: 'Noto Sans KR', sans-serif; }
    #app-container { display: flex; flex-direction: column; height: 100%; }
    main { flex-grow: 1; overflow-y: auto; }
    .chip-color-sample { width: 40px; height: 40px; border-radius: 50%; border: 2px solid #ccc; cursor: pointer; position: relative; }
    .chip-color-sample.selected { border: 3px solid #fbbf24; }
    .chip-image-preview { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; }
    .analyzing-overlay { background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .pulse-animation { animation: pulse 2s infinite; }
  </style>
</head>
<body class="bg-gray-900 text-white">
  <div id="app-container">
    <!-- í—¤ë” -->
    <div class="bg-gray-900 border-b border-gray-700 px-3 py-2">
      <div class="flex justify-between items-center">
        <span class="font-bold text-amber-400">í¬ì»¤ í•¸ë“œ ë¡œê±° AI</span>
        <span class="text-gray-400 text-sm">v2.2.0</span>
      </div>
    </div>

    <main class="p-4 space-y-4">
      <!-- ì¹© ì»¬ëŸ¬ ë“±ë¡ ì„¹ì…˜ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-lg font-bold mb-3 text-amber-400">ì¹© ì»¬ëŸ¬ ë“±ë¡</h2>
        <div class="flex gap-3 items-center flex-wrap">
          <div id="chip-colors-container" class="flex gap-2">
            <!-- ì¹© ì»¬ëŸ¬ ìŠ¬ë¡¯ë“¤ì´ ì—¬ê¸° ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
          </div>
          <button id="add-chip-color-btn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-medium">
            + ì¹© ì¶”ê°€
          </button>
        </div>
        <div id="chip-values-container" class="mt-3 space-y-2 hidden">
          <!-- ì¹© ê°’ ì…ë ¥ í•„ë“œë“¤ì´ ì—¬ê¸° ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
        </div>
      </div>

      <!-- í”Œë ˆì´ì–´ ì¹© ìŠ¤íƒ ë¶„ì„ ì„¹ì…˜ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-lg font-bold mb-3 text-amber-400">í”Œë ˆì´ì–´ ì¹© ìŠ¤íƒ</h2>
        <div id="players-chip-analysis" class="space-y-3">
          <!-- í”Œë ˆì´ì–´ë³„ ì¹© ë¶„ì„ ë²„íŠ¼ë“¤ì´ ì—¬ê¸° ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
        </div>
      </div>

      <!-- ë¶„ì„ ê²°ê³¼ í‘œì‹œ -->
      <div id="analysis-results" class="bg-gray-800 p-4 rounded-lg hidden">
        <h2 class="text-lg font-bold mb-3 text-green-400">ë¶„ì„ ê²°ê³¼</h2>
        <div id="results-content" class="space-y-2">
          <!-- ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸° í‘œì‹œë¨ -->
        </div>
      </div>
    </main>
  </div>

  <!-- ì¹© ì»¬ëŸ¬ ì´¬ì˜ ëª¨ë‹¬ -->
  <div id="chip-color-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden z-50">
    <div class="flex items-center justify-center h-full p-4">
      <div class="bg-gray-800 rounded-lg p-4 max-w-md w-full">
        <h3 class="text-lg font-bold mb-3">ì¹© ì‚¬ì§„ ì´¬ì˜</h3>
        <video id="chip-video" class="w-full rounded-lg mb-3" autoplay playsinline></video>
        <canvas id="chip-canvas" class="hidden"></canvas>
        <div class="flex gap-2">
          <button id="capture-chip-btn" class="flex-1 bg-green-600 hover:bg-green-700 py-2 rounded-lg font-medium">
            ì´¬ì˜
          </button>
          <button id="close-chip-modal" class="flex-1 bg-gray-600 hover:bg-gray-700 py-2 rounded-lg font-medium">
            ì·¨ì†Œ
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ì¹© ìŠ¤íƒ ë¶„ì„ ëª¨ë‹¬ -->
  <div id="stack-analysis-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden z-50">
    <div class="flex items-center justify-center h-full p-4">
      <div class="bg-gray-800 rounded-lg p-4 max-w-lg w-full max-h-[90vh] overflow-y-auto">
        <h3 class="text-lg font-bold mb-3">
          <span id="analyzing-player-name">í”Œë ˆì´ì–´</span> ì¹© ìŠ¤íƒ ë¶„ì„
        </h3>
        
        <div id="stack-images-container" class="grid grid-cols-2 gap-2 mb-3">
          <!-- ì´¬ì˜ëœ ì´ë¯¸ì§€ë“¤ì´ ì—¬ê¸° í‘œì‹œë¨ -->
        </div>
        
        <video id="stack-video" class="w-full rounded-lg mb-3" autoplay playsinline></video>
        <canvas id="stack-canvas" class="hidden"></canvas>
        
        <div class="flex gap-2 mb-3">
          <button id="capture-stack-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 py-2 rounded-lg font-medium">
            ì‚¬ì§„ ì¶”ê°€
          </button>
          <button id="analyze-stack-btn" class="flex-1 bg-green-600 hover:bg-green-700 py-2 rounded-lg font-medium" disabled>
            AI ë¶„ì„ ì‹œì‘
          </button>
        </div>
        
        <button id="close-stack-modal" class="w-full bg-gray-600 hover:bg-gray-700 py-2 rounded-lg font-medium">
          ë‹«ê¸°
        </button>
      </div>
    </div>
  </div>

  <!-- AI ë¶„ì„ ì¤‘ ì˜¤ë²„ë ˆì´ -->
  <div id="analyzing-overlay" class="fixed inset-0 analyzing-overlay hidden z-[60]">
    <div class="flex items-center justify-center h-full">
      <div class="bg-gray-900 rounded-lg p-6 text-center">
        <div class="text-3xl mb-3 pulse-animation">ğŸ¤–</div>
        <p class="text-lg font-medium mb-2">AI ë¶„ì„ ì¤‘...</p>
        <p class="text-sm text-gray-400">ì¹© ìŠ¤íƒì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤</p>
      </div>
    </div>
  </div>

  <script>
    // Gemini API ì„¤ì •
    const GEMINI_API_KEY = 'AIzaSyBB8uqP1ECTe40jknSy5XK71TCs8_KbGV0';
    const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';

    // ì•± ìƒíƒœ ê´€ë¦¬
    const chipState = {
      chipColors: [], // ë“±ë¡ëœ ì¹© ì»¬ëŸ¬ ì •ë³´ [{color: '#fff', value: 1000, image: 'base64...'}]
      maxChips: 5,
      currentChipSlot: null,
      playerStacks: {}, // {playerName: {images: [], estimatedStack: 0}}
      currentAnalyzingPlayer: null,
      stackImages: [] // í˜„ì¬ ì´¬ì˜ ì¤‘ì¸ ìŠ¤íƒ ì´ë¯¸ì§€ë“¤
    };

    // ì˜ˆì‹œ í”Œë ˆì´ì–´ ë°ì´í„° (ì‹¤ì œ ì•±ì—ì„œëŠ” ê¸°ì¡´ ìƒíƒœì—ì„œ ê°€ì ¸ì˜´)
    const samplePlayers = [
      { name: 'Player A', seat: 1, chips: 0 },
      { name: 'Player B', seat: 2, chips: 0 },
      { name: 'Player C', seat: 3, chips: 0 },
      { name: 'Player D', seat: 4, chips: 0 }
    ];

    // ì´ˆê¸°í™”
    function initChipAnalyzer() {
      console.log('ì¹© ë¶„ì„ê¸° ì´ˆê¸°í™” v2.2.0');
      
      // ì¹© ì»¬ëŸ¬ ìŠ¬ë¡¯ ë Œë”ë§
      renderChipColorSlots();
      
      // í”Œë ˆì´ì–´ ì¹© ë¶„ì„ ë²„íŠ¼ ë Œë”ë§
      renderPlayerChipButtons();
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      setupEventListeners();
      
      // localStorageì—ì„œ ì €ì¥ëœ ì¹© ì»¬ëŸ¬ ë¡œë“œ
      loadSavedChipColors();
    }

    // ì¹© ì»¬ëŸ¬ ìŠ¬ë¡¯ ë Œë”ë§
    function renderChipColorSlots() {
      const container = document.getElementById('chip-colors-container');
      container.innerHTML = '';
      
      for (let i = 0; i < chipState.maxChips; i++) {
        const chip = chipState.chipColors[i];
        const slot = document.createElement('div');
        slot.className = 'chip-color-sample flex items-center justify-center';
        slot.dataset.slot = i;
        
        if (chip) {
          slot.style.backgroundColor = chip.color;
          if (chip.image) {
            slot.style.backgroundImage = `url(${chip.image})`;
            slot.style.backgroundSize = 'cover';
          }
          slot.innerHTML = `<span class="text-white text-xs font-bold">${chip.value}</span>`;
        } else {
          slot.classList.add('bg-gray-700');
          slot.innerHTML = '<span class="text-gray-500">+</span>';
        }
        
        slot.addEventListener('click', () => selectChipSlot(i));
        container.appendChild(slot);
      }
      
      // ì¹© ê°’ ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸
      if (chipState.chipColors.length > 0) {
        renderChipValueInputs();
      }
    }

    // ì¹© ê°’ ì…ë ¥ í•„ë“œ ë Œë”ë§
    function renderChipValueInputs() {
      const container = document.getElementById('chip-values-container');
      container.innerHTML = '';
      container.classList.remove('hidden');
      
      chipState.chipColors.forEach((chip, index) => {
        const div = document.createElement('div');
        div.className = 'flex items-center gap-2';
        div.innerHTML = `
          <div class="w-6 h-6 rounded-full" style="background-color: ${chip.color}"></div>
          <input type="text" 
            class="bg-gray-700 px-2 py-1 rounded text-sm flex-1" 
            placeholder="ì¹© ê°’ (ì˜ˆ: 1000)"
            value="${chip.value || ''}"
            data-index="${index}">
          <button class="text-red-500 hover:text-red-400 text-sm" data-remove="${index}">ì‚­ì œ</button>
        `;
        container.appendChild(div);
      });
      
      // ê°’ ë³€ê²½ ì´ë²¤íŠ¸
      container.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', (e) => {
          const index = parseInt(e.target.dataset.index);
          const value = parseInt(e.target.value.replace(/\D/g, '')) || 0;
          chipState.chipColors[index].value = value;
          saveChipColors();
          renderChipColorSlots();
        });
      });
      
      // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
      container.querySelectorAll('[data-remove]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const index = parseInt(e.target.dataset.remove);
          chipState.chipColors.splice(index, 1);
          saveChipColors();
          renderChipColorSlots();
        });
      });
    }

    // í”Œë ˆì´ì–´ ì¹© ë¶„ì„ ë²„íŠ¼ ë Œë”ë§
    function renderPlayerChipButtons() {
      const container = document.getElementById('players-chip-analysis');
      container.innerHTML = '';
      
      samplePlayers.forEach(player => {
        const div = document.createElement('div');
        div.className = 'flex items-center justify-between bg-gray-700 p-3 rounded-lg';
        
        const stack = chipState.playerStacks[player.name];
        const estimatedChips = stack?.estimatedStack || player.chips || 0;
        
        div.innerHTML = `
          <div>
            <span class="font-medium">${player.name}</span>
            <span class="text-sm text-gray-400 ml-2">Seat ${player.seat}</span>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-amber-400 font-medium">
              ${estimatedChips ? estimatedChips.toLocaleString() : 'ë¯¸ë¶„ì„'}
            </span>
            <button class="bg-purple-600 hover:bg-purple-700 px-3 py-1 rounded text-sm font-medium"
              data-player="${player.name}">
              ğŸ“· ì¹© ë¶„ì„
            </button>
          </div>
        `;
        
        container.appendChild(div);
      });
      
      // ë¶„ì„ ë²„íŠ¼ ì´ë²¤íŠ¸
      container.querySelectorAll('[data-player]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const playerName = e.target.dataset.player;
          openStackAnalysisModal(playerName);
        });
      });
    }

    // ì¹© ìŠ¬ë¡¯ ì„ íƒ
    function selectChipSlot(slotIndex) {
      chipState.currentChipSlot = slotIndex;
      openChipColorModal();
    }

    // ì¹© ì»¬ëŸ¬ ì´¬ì˜ ëª¨ë‹¬ ì—´ê¸°
    async function openChipColorModal() {
      const modal = document.getElementById('chip-color-modal');
      modal.classList.remove('hidden');
      
      try {
        const video = document.getElementById('chip-video');
        const stream = await navigator.mediaDevices.getUserMedia({ 
          video: { facingMode: 'environment' } 
        });
        video.srcObject = stream;
      } catch (err) {
        console.error('ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨:', err);
        alert('ì¹´ë©”ë¼ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
    }

    // ì¹© ì‚¬ì§„ ì´¬ì˜
    function captureChipPhoto() {
      const video = document.getElementById('chip-video');
      const canvas = document.getElementById('chip-canvas');
      const context = canvas.getContext('2d');
      
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0);
      
      const imageData = canvas.toDataURL('image/jpeg', 0.8);
      
      // ì¤‘ì•™ ìƒ‰ìƒ ì¶”ì¶œ (ê°„ë‹¨í•œ êµ¬í˜„)
      const centerX = Math.floor(canvas.width / 2);
      const centerY = Math.floor(canvas.height / 2);
      const pixel = context.getImageData(centerX, centerY, 1, 1).data;
      const color = `rgb(${pixel[0]}, ${pixel[1]}, ${pixel[2]})`;
      
      // ì¹© ì •ë³´ ì €ì¥
      if (chipState.currentChipSlot !== null) {
        if (!chipState.chipColors[chipState.currentChipSlot]) {
          chipState.chipColors[chipState.currentChipSlot] = {};
        }
        chipState.chipColors[chipState.currentChipSlot].color = color;
        chipState.chipColors[chipState.currentChipSlot].image = imageData;
        chipState.chipColors[chipState.currentChipSlot].value = chipState.chipColors[chipState.currentChipSlot].value || 0;
        
        saveChipColors();
        renderChipColorSlots();
        closeChipColorModal();
      }
    }

    // ì¹© ì»¬ëŸ¬ ëª¨ë‹¬ ë‹«ê¸°
    function closeChipColorModal() {
      const modal = document.getElementById('chip-color-modal');
      const video = document.getElementById('chip-video');
      
      if (video.srcObject) {
        video.srcObject.getTracks().forEach(track => track.stop());
      }
      
      modal.classList.add('hidden');
      chipState.currentChipSlot = null;
    }

    // ìŠ¤íƒ ë¶„ì„ ëª¨ë‹¬ ì—´ê¸°
    async function openStackAnalysisModal(playerName) {
      chipState.currentAnalyzingPlayer = playerName;
      chipState.stackImages = [];
      
      const modal = document.getElementById('stack-analysis-modal');
      document.getElementById('analyzing-player-name').textContent = playerName;
      document.getElementById('stack-images-container').innerHTML = '';
      document.getElementById('analyze-stack-btn').disabled = true;
      
      modal.classList.remove('hidden');
      
      try {
        const video = document.getElementById('stack-video');
        const stream = await navigator.mediaDevices.getUserMedia({ 
          video: { facingMode: 'environment' } 
        });
        video.srcObject = stream;
      } catch (err) {
        console.error('ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨:', err);
        alert('ì¹´ë©”ë¼ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
    }

    // ìŠ¤íƒ ì‚¬ì§„ ì´¬ì˜
    function captureStackPhoto() {
      const video = document.getElementById('stack-video');
      const canvas = document.getElementById('stack-canvas');
      const context = canvas.getContext('2d');
      
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0);
      
      const imageData = canvas.toDataURL('image/jpeg', 0.8);
      chipState.stackImages.push(imageData);
      
      // ì´ë¯¸ì§€ í”„ë¦¬ë·° ì¶”ê°€
      const container = document.getElementById('stack-images-container');
      const img = document.createElement('img');
      img.src = imageData;
      img.className = 'chip-image-preview border-2 border-gray-600';
      container.appendChild(img);
      
      // ë¶„ì„ ë²„íŠ¼ í™œì„±í™”
      if (chipState.stackImages.length > 0) {
        document.getElementById('analyze-stack-btn').disabled = false;
      }
    }

    // AI ì¹© ìŠ¤íƒ ë¶„ì„
    async function analyzeChipStack() {
      if (chipState.stackImages.length === 0) {
        alert('ë¨¼ì € ì‚¬ì§„ì„ ì´¬ì˜í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ë¶„ì„ ì¤‘ ì˜¤ë²„ë ˆì´ í‘œì‹œ
      document.getElementById('analyzing-overlay').classList.remove('hidden');
      
      try {
        // ì¹© ì»¬ëŸ¬ ì •ë³´ ì¤€ë¹„
        const chipInfo = chipState.chipColors
          .filter(c => c && c.value)
          .map(c => `ê°’ ${c.value}: ${c.color}`)
          .join(', ');
        
        // Gemini API í˜¸ì¶œì„ ìœ„í•œ ì´ë¯¸ì§€ ì¤€ë¹„
        const imageParts = chipState.stackImages.map(imageData => ({
          inline_data: {
            mime_type: "image/jpeg",
            data: imageData.split(',')[1] // base64 ë¶€ë¶„ë§Œ ì¶”ì¶œ
          }
        }));
        
        // Gemini API ìš”ì²­
        const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{
              parts: [
                {
                  text: `ì´ í¬ì»¤ ì¹© ìŠ¤íƒ ì‚¬ì§„ë“¤ì„ ë¶„ì„í•´ì£¼ì„¸ìš”. 
                  ë“±ë¡ëœ ì¹© ì •ë³´: ${chipInfo || 'ì¹© ì •ë³´ ì—†ìŒ'}
                  
                  ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”:
                  1. ë³´ì´ëŠ” ì¹©ì˜ ê°œìˆ˜ì™€ ìƒ‰ìƒë³„ ë¶„í¬
                  2. ëŒ€ëµì ì¸ ì´ ì¹© ê°œìˆ˜ ì¶”ì •
                  3. ì´ ì¹© ê°€ì¹˜ ì¶”ì • (ë“±ë¡ëœ ì¹© ì •ë³´ ê¸°ë°˜)
                  
                  ìˆ«ìë§Œ ê°„ë‹¨ëª…ë£Œí•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”.`
                },
                ...imageParts
              ]
            }],
            generationConfig: {
              temperature: 0.2,
              topK: 32,
              topP: 1,
              maxOutputTokens: 1024,
            }
          })
        });
        
        const data = await response.json();
        console.log('Gemini API ì‘ë‹µ:', data);
        
        if (data.candidates && data.candidates[0]) {
          const analysisText = data.candidates[0].content.parts[0].text;
          
          // ìˆ«ì ì¶”ì¶œ (ê°„ë‹¨í•œ íŒŒì‹±)
          const numberMatch = analysisText.match(/[\d,]+(?:\s*ë§Œ)?(?:\s*ì²œ)?/g);
          let estimatedValue = 0;
          
          if (numberMatch) {
            const lastNumber = numberMatch[numberMatch.length - 1];
            estimatedValue = parseKoreanNumber(lastNumber);
          }
          
          // ê²°ê³¼ ì €ì¥
          if (!chipState.playerStacks[chipState.currentAnalyzingPlayer]) {
            chipState.playerStacks[chipState.currentAnalyzingPlayer] = {};
          }
          chipState.playerStacks[chipState.currentAnalyzingPlayer].images = [...chipState.stackImages];
          chipState.playerStacks[chipState.currentAnalyzingPlayer].estimatedStack = estimatedValue;
          chipState.playerStacks[chipState.currentAnalyzingPlayer].analysis = analysisText;
          
          // UI ì—…ë°ì´íŠ¸
          renderPlayerChipButtons();
          showAnalysisResults(chipState.currentAnalyzingPlayer, analysisText, estimatedValue);
          
          // ëª¨ë‹¬ ë‹«ê¸°
          closeStackAnalysisModal();
        }
        
      } catch (error) {
        console.error('AI ë¶„ì„ ì‹¤íŒ¨:', error);
        alert('AI ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      } finally {
        // ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
        document.getElementById('analyzing-overlay').classList.add('hidden');
      }
    }

    // í•œêµ­ì–´ ìˆ«ì íŒŒì‹±
    function parseKoreanNumber(str) {
      if (!str) return 0;
      
      str = str.replace(/,/g, '');
      let value = parseFloat(str) || 0;
      
      if (str.includes('ë§Œ')) value *= 10000;
      if (str.includes('ì²œ')) value *= 1000;
      
      return Math.floor(value);
    }

    // ë¶„ì„ ê²°ê³¼ í‘œì‹œ
    function showAnalysisResults(playerName, analysisText, estimatedValue) {
      const resultsDiv = document.getElementById('analysis-results');
      const content = document.getElementById('results-content');
      
      resultsDiv.classList.remove('hidden');
      
      content.innerHTML = `
        <div class="bg-gray-700 p-3 rounded-lg">
          <h3 class="font-bold text-amber-400 mb-2">${playerName}</h3>
          <div class="text-2xl font-bold text-green-400 mb-2">
            ì¶”ì • ì¹©: ${estimatedValue.toLocaleString()}
          </div>
          <div class="text-sm text-gray-300 whitespace-pre-line">
            ${analysisText}
          </div>
        </div>
      `;
    }

    // ìŠ¤íƒ ë¶„ì„ ëª¨ë‹¬ ë‹«ê¸°
    function closeStackAnalysisModal() {
      const modal = document.getElementById('stack-analysis-modal');
      const video = document.getElementById('stack-video');
      
      if (video.srcObject) {
        video.srcObject.getTracks().forEach(track => track.stop());
      }
      
      modal.classList.add('hidden');
      chipState.currentAnalyzingPlayer = null;
      chipState.stackImages = [];
    }

    // ì¹© ì»¬ëŸ¬ ì €ì¥
    function saveChipColors() {
      localStorage.setItem('pokerChipColors', JSON.stringify(chipState.chipColors));
    }

    // ì €ì¥ëœ ì¹© ì»¬ëŸ¬ ë¡œë“œ
    function loadSavedChipColors() {
      const saved = localStorage.getItem('pokerChipColors');
      if (saved) {
        try {
          chipState.chipColors = JSON.parse(saved);
          renderChipColorSlots();
        } catch (e) {
          console.error('ì¹© ì»¬ëŸ¬ ë¡œë“œ ì‹¤íŒ¨:', e);
        }
      }
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    function setupEventListeners() {
      // ì¹© ì¶”ê°€ ë²„íŠ¼
      document.getElementById('add-chip-color-btn').addEventListener('click', () => {
        if (chipState.chipColors.length < chipState.maxChips) {
          const emptySlot = chipState.chipColors.length;
          selectChipSlot(emptySlot);
        } else {
          alert('ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        }
      });
      
      // ì¹© ì´¬ì˜ ë²„íŠ¼
      document.getElementById('capture-chip-btn').addEventListener('click', captureChipPhoto);
      document.getElementById('close-chip-modal').addEventListener('click', closeChipColorModal);
      
      // ìŠ¤íƒ ì´¬ì˜ ë²„íŠ¼
      document.getElementById('capture-stack-btn').addEventListener('click', captureStackPhoto);
      document.getElementById('analyze-stack-btn').addEventListener('click', analyzeChipStack);
      document.getElementById('close-stack-modal').addEventListener('click', closeStackAnalysisModal);
    }

    // ì•± ì‹œì‘
    document.addEventListener('DOMContentLoaded', initChipAnalyzer);
  </script>
</body>
</html>