# 📋 H열 큰따옴표 처리 가이드

## 🎯 목적
CSV 멀티라인 문제를 근본적으로 해결하기 위해 Google Sheets의 H열(설명/메모) 데이터를 큰따옴표로 감싸서 RFC 4180 표준을 준수하도록 변환합니다.

## ⚠️ 실행 전 필수 체크리스트

### 1️⃣ **백업 생성 (필수!)**
```
1. Google Sheets 열기
2. 파일 → 복사본 만들기
3. 이름: "Virtual_백업_20250918" (날짜 포함)
4. 백업 확인 후 진행
```

### 2️⃣ **스크립트 설치**
```
1. Google Sheets에서 확장 프로그램 → Apps Script 클릭
2. 기존 코드 전체 선택 후 삭제
3. wrap_h_column_with_quotes.gs 내용 전체 복사
4. Apps Script 편집기에 붙여넣기
5. 저장 (Ctrl+S)
6. 파일명: "H열_큰따옴표_처리"
```

## 🚀 실행 단계

### 단계 1: 데이터 분석 (권장)
```javascript
// Apps Script 편집기에서
1. 함수 선택: analyzeHColumnData
2. 실행 버튼 클릭 (▶️)
3. 권한 승인 (처음 실행 시)
4. 실행 로그에서 통계 확인
```

**확인할 내용:**
- 전체 행 수
- 큰따옴표 없는 데이터 개수
- 멀티라인 데이터 개수

### 단계 2: 미리보기 (권장)
```javascript
// 처음 10개 데이터만 미리보기
1. 함수 선택: previewHColumnTransformation
2. 실행 버튼 클릭
3. 로그에서 변환 예시 확인
```

### 단계 3: 실제 변환 실행
```javascript
// 전체 H열 데이터 변환
1. 함수 선택: wrapHColumnWithQuotes
2. 실행 버튼 클릭
3. 확인 대화상자에서 "예" 클릭
4. 처리 완료 메시지 확인
```

### 단계 4: 결과 확인
```
1. Google Sheets로 돌아가기
2. H열 데이터 확인
3. 멀티라인 텍스트가 있는 셀 확인
4. 큰따옴표로 감싸진 것 확인
```

### 단계 5: CSV 재게시
```
1. 파일 → 웹에 게시
2. 게시 중지 클릭
3. 다시 게시 클릭
4. CSV 형식 선택 확인
5. 게시 URL 복사
```

## 🔄 복구 방법 (필요시)

### 큰따옴표 제거하기
```javascript
// 원래 상태로 복구
1. 함수 선택: unwrapHColumnQuotes
2. 실행 버튼 클릭
3. 확인 대화상자에서 "예" 클릭
```

### 백업에서 복원
```
1. 백업 파일 열기
2. H열 전체 선택 (H4:H 끝까지)
3. 복사 (Ctrl+C)
4. 원본 파일 열기
5. H4 셀 선택
6. 붙여넣기 (Ctrl+V)
```

## 📊 예상 결과

### 변환 전
```
H4: 설명 텍스트
H5: 여러 줄의
텍스트입니다
H6: 쉼표,가 있는 텍스트
```

### 변환 후
```
H4: "설명 텍스트"
H5: "여러 줄의
텍스트입니다"
H6: "쉼표,가 있는 텍스트"
```

## 🧪 테스트 방법

### 1. CSV 다운로드 테스트
```
1. 게시된 CSV URL 접속
2. CSV 파일 다운로드
3. 텍스트 에디터로 열기
4. H열 데이터가 큰따옴표로 묶여있는지 확인
```

### 2. 웹 애플리케이션 테스트
```
1. http://localhost:8080 접속
2. F12로 콘솔 열기
3. 새로고침 (F5)
4. "Papa Parse 사용: XXX개 행 파싱 완료" 확인
5. "17시 이후 데이터: XXX개 행" 확인
6. 이전보다 행 수가 줄어들었는지 확인 (멀티라인 문제 해결)
```

## ❓ 문제 해결

### 권한 오류
```
해결:
1. Apps Script 실행 시 권한 승인
2. "고급" 클릭
3. "안전하지 않은 페이지로 이동" 클릭
4. 권한 허용
```

### 스크립트 찾을 수 없음
```
해결:
1. Apps Script 편집기 새로고침
2. 저장 확인 (Ctrl+S)
3. 함수 드롭다운 새로고침
```

### 시트를 찾을 수 없음
```
해결:
1. 시트 이름이 'Virtual'인지 확인
2. 필요시 스크립트의 SHEET_NAME 변수 수정
```

## 📝 로그 확인

Apps Script 편집기에서:
1. 보기 → 실행 로그
2. 또는 Ctrl+Enter로 로그 창 열기
3. 처리 과정 상세 확인

## ✅ 작업 완료 체크리스트

- [ ] 백업 생성 완료
- [ ] 스크립트 설치 완료
- [ ] 데이터 분석 실행
- [ ] 미리보기 확인
- [ ] H열 변환 실행
- [ ] 결과 확인
- [ ] CSV 재게시
- [ ] 웹 애플리케이션 테스트
- [ ] 17시 이후 데이터 정상 로드 확인

## 🎯 기대 효과

1. **CSV 파싱 정확도 향상**: 멀티라인 데이터가 정확히 한 행으로 인식
2. **17시 이후 데이터 복구**: 잘못 분리된 행들이 올바르게 병합
3. **데이터 무결성 보장**: RFC 4180 표준 준수로 안정적인 데이터 교환

---

**작성일**: 2025-09-18
**스크립트 버전**: 1.0.0
**호환성**: Google Apps Script V8 엔진