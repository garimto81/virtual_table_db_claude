<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•¸ë“œ ë¶ˆëŸ¬ì˜¤ê¸° ë””ë²„ê¹…</title>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background: #1a1a1a; color: white; padding: 20px; }
        .section { background: #333; border-radius: 8px; padding: 15px; margin: 20px 0; }
        h2 { color: #fbbf24; }
        .log { background: #222; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
        button { background: #4b5563; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #6b7280; }
        pre { background: #111; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” í•¸ë“œ ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥ ë””ë²„ê¹…</h1>
    
    <div class="section">
        <h2>1. ìƒíƒœ í™•ì¸</h2>
        <button onclick="checkState()">ìƒíƒœ ì²´í¬</button>
        <div id="state-log" class="log"></div>
    </div>
    
    <div class="section">
        <h2>2. CSV ë°ì´í„° í™•ì¸</h2>
        <button onclick="checkCSV()">CSV ë¡œë“œ í…ŒìŠ¤íŠ¸</button>
        <div id="csv-log" class="log"></div>
    </div>
    
    <div class="section">
        <h2>3. Index ë°ì´í„° í™•ì¸</h2>
        <button onclick="checkIndex()">Index ë°ì´í„° í™•ì¸</button>
        <div id="index-log" class="log"></div>
    </div>
    
    <div class="section">
        <h2>4. í•¸ë“œ ë¶ˆëŸ¬ì˜¤ê¸° í…ŒìŠ¤íŠ¸</h2>
        <input type="number" id="hand-number" placeholder="í•¸ë“œ ë²ˆí˜¸" value="1">
        <button onclick="testLoadHand()">í•¸ë“œ ë¶ˆëŸ¬ì˜¤ê¸° í…ŒìŠ¤íŠ¸</button>
        <div id="load-log" class="log"></div>
    </div>
    
    <div class="section">
        <h2>5. ëª¨ë‹¬ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testModal()">ëª¨ë‹¬ ì—´ê¸° í…ŒìŠ¤íŠ¸</button>
        <div id="modal-log" class="log"></div>
    </div>
    
    <button onclick="location.href='index.html'">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    
    <script>
        // ì „ì—­ ìƒíƒœ ì‹œë®¬ë ˆì´ì…˜
        const state = {
            indexRows: [],
            handCsvCache: null,
            playersInHand: [],
            board: [],
            playerStatus: {},
            actionState: {
                handNumber: '',
                smallBlind: '',
                bigBlind: '',
                hasBBAnte: false,
                preflop: [],
                flop: [],
                turn: [],
                river: []
            }
        };
        
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            element.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
        }
        
        async function checkState() {
            log('state-log', 'í˜„ì¬ ìƒíƒœ í™•ì¸ ì¤‘...', 'info');
            
            // localStorage ì²´í¬
            const savedState = localStorage.getItem('pokerHandLoggerState');
            if(savedState) {
                log('state-log', 'âœ… localStorageì— ì €ì¥ëœ ìƒíƒœ ë°œê²¬', 'success');
                const parsed = JSON.parse(savedState);
                log('state-log', `í•¸ë“œ ë²ˆí˜¸: ${parsed.actionState?.handNumber || 'ì—†ìŒ'}`, 'info');
            } else {
                log('state-log', 'âŒ localStorageì— ì €ì¥ëœ ìƒíƒœ ì—†ìŒ', 'error');
            }
            
            // ì‹¤ì œ í˜ì´ì§€ì˜ ìš”ì†Œ í™•ì¸
            log('state-log', 'DOM ìš”ì†Œ í™•ì¸...', 'info');
            const loadBtn = document.getElementById('load-hand-btn');
            const modal = document.getElementById('load-hand-modal');
            
            if(loadBtn) {
                log('state-log', 'âœ… Load ë²„íŠ¼ ì¡´ì¬', 'success');
            } else {
                log('state-log', 'âŒ Load ë²„íŠ¼ ì—†ìŒ', 'error');
            }
            
            if(modal) {
                log('state-log', 'âœ… Load Modal ì¡´ì¬', 'success');
            } else {
                log('state-log', 'âŒ Load Modal ì—†ìŒ', 'error');
            }
        }
        
        async function checkCSV() {
            log('csv-log', 'CSV ë¡œë“œ ì‹œì‘...', 'info');
            
            try {
                // Hand CSV URL (ì˜ˆì‹œ - ì‹¤ì œ URLë¡œ êµì²´ í•„ìš”)
                const CSV_HAND_URL = 'https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/gviz/tq?tqx=out:csv&sheet=Hand';
                
                log('csv-log', `URL: ${CSV_HAND_URL}`, 'info');
                
                // ì‹¤ì œë¡œëŠ” fetchCsv í•¨ìˆ˜ë¥¼ ì‚¬ìš©
                const response = await fetch(CSV_HAND_URL + `&cb=${Date.now()}`);
                
                if(response.ok) {
                    const text = await response.text();
                    const lines = text.split('\n').length;
                    log('csv-log', `âœ… CSV ë¡œë“œ ì„±ê³µ: ${lines} í–‰`, 'success');
                    
                    // ì²« ëª‡ ì¤„ í‘œì‹œ
                    const preview = text.split('\n').slice(0, 5).join('\n');
                    log('csv-log', `<pre>${preview}</pre>`, 'info');
                } else {
                    log('csv-log', `âŒ CSV ë¡œë“œ ì‹¤íŒ¨: ${response.status}`, 'error');
                }
            } catch(err) {
                log('csv-log', `âŒ ì˜¤ë¥˜: ${err.message}`, 'error');
                log('csv-log', 'CSV URLì„ í™•ì¸í•˜ê³  CORS ì„¤ì •ì„ ì ê²€í•˜ì„¸ìš”.', 'info');
            }
        }
        
        async function checkIndex() {
            log('index-log', 'Index ë°ì´í„° í™•ì¸...', 'info');
            
            try {
                // Index CSV URL (ì˜ˆì‹œ)
                const CSV_INDEX_URL = 'https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/gviz/tq?tqx=out:csv&sheet=Index';
                
                const response = await fetch(CSV_INDEX_URL + `&cb=${Date.now()}`);
                
                if(response.ok) {
                    const text = await response.text();
                    const lines = text.split('\n');
                    
                    log('index-log', `âœ… Index ë¡œë“œ ì„±ê³µ: ${lines.length} í–‰`, 'success');
                    
                    // íŒŒì‹± ì‹œë®¬ë ˆì´ì…˜
                    const headers = lines[0].split(',');
                    log('index-log', `í—¤ë”: ${headers.slice(0, 5).join(', ')}...`, 'info');
                    
                    // ìµœê·¼ í•¸ë“œ ëª‡ ê°œ í‘œì‹œ
                    const recentHands = lines.slice(1, 4).map(line => {
                        const cols = line.split(',');
                        return `í•¸ë“œ #${cols[0]}: ${cols[7]} (${cols[16]})`;
                    });
                    
                    recentHands.forEach(hand => {
                        log('index-log', hand, 'info');
                    });
                } else {
                    log('index-log', `âŒ Index ë¡œë“œ ì‹¤íŒ¨: ${response.status}`, 'error');
                }
            } catch(err) {
                log('index-log', `âŒ ì˜¤ë¥˜: ${err.message}`, 'error');
            }
        }
        
        async function testLoadHand() {
            const handNumber = document.getElementById('hand-number').value;
            log('load-log', `í•¸ë“œ #${handNumber} ë¶ˆëŸ¬ì˜¤ê¸° í…ŒìŠ¤íŠ¸...`, 'info');
            
            try {
                // parseHandBlock ì‹œë®¬ë ˆì´ì…˜
                log('load-log', '1. Hand CSVì—ì„œ í•´ë‹¹ í•¸ë“œ ê²€ìƒ‰ ì¤‘...', 'info');
                
                // ì‹¤ì œë¡œëŠ” parseHandBlock í•¨ìˆ˜ ì‚¬ìš©
                const mockData = {
                    handNumber: handNumber,
                    smallBlind: '50',
                    bigBlind: '100',
                    ante: 0,
                    table: 'Table 1',
                    players: [
                        { name: 'Player1', seat: 1, initialChips: '1000', finalChips: '1200', hand: ['As', 'Kd'] },
                        { name: 'Player2', seat: 2, initialChips: '1000', finalChips: '800', hand: ['Qh', 'Qc'] }
                    ],
                    board: ['Ah', '7d', '2c', 'Js', '9h'],
                    actions: {
                        preflop: [
                            { player: 'Player1', action: 'Raises', amount: '300' },
                            { player: 'Player2', action: 'Calls', amount: '300' }
                        ],
                        flop: [],
                        turn: [],
                        river: []
                    }
                };
                
                log('load-log', '2. ë°ì´í„° íŒŒì‹± ì™„ë£Œ', 'success');
                log('load-log', `<pre>${JSON.stringify(mockData, null, 2)}</pre>`, 'info');
                
                // ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜
                log('load-log', '3. ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘...', 'info');
                state.playersInHand = mockData.players;
                state.board = mockData.board;
                state.actionState.handNumber = mockData.handNumber;
                
                log('load-log', 'âœ… í•¸ë“œ ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ!', 'success');
                
            } catch(err) {
                log('load-log', `âŒ ì˜¤ë¥˜: ${err.message}`, 'error');
            }
        }
        
        function testModal() {
            log('modal-log', 'ëª¨ë‹¬ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            // ê°„ë‹¨í•œ ëª¨ë‹¬ ìƒì„±
            const modalHtml = `
                <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                            background: #444; padding: 20px; border-radius: 8px; z-index: 1000;">
                    <h3>í…ŒìŠ¤íŠ¸ ëª¨ë‹¬</h3>
                    <p>ëª¨ë‹¬ì´ ì •ìƒì ìœ¼ë¡œ ì—´ë ¸ìŠµë‹ˆë‹¤!</p>
                    <button onclick="this.parentElement.remove()">ë‹«ê¸°</button>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            log('modal-log', 'âœ… ëª¨ë‹¬ ìƒì„± ì™„ë£Œ', 'success');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ì²´í¬
        window.onload = () => {
            log('state-log', 'í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'success');
            checkState();
        };
    </script>
</body>
</html>