# 🎯 포커 핸드 모니터링 시스템 v9.5.0

**실시간 포커 핸드 분석 및 Virtual 시트 매칭 시스템**

## 📋 프로젝트 개요

### 핵심 목적
- 실시간 포커 핸드 데이터 모니터링
- 키 플레이어 분석 및 추적
- Virtual 시트와의 정확한 시간 매칭
- AI 기반 핸드 분석 및 자동 파일명 생성

### 주요 특징
- **단일 HTML 파일** 구조로 간단한 배포
- **실시간 데이터 동기화** (10초 간격)
- **개선된 Virtual 시트 매칭** (±3분 범위 검색)
- **로컬 상태 저장** (완료 상태 복구)
- **AI 분석 통합** (OpenAI, Gemini, Claude 지원)

---

## 🗂 프로젝트 구조

```
virtual_table_db_gpt/
├── index.html          # 메인 애플리케이션 (단일 파일)
├── _config.yml         # GitHub Pages 설정
└── README.md          # 프로젝트 문서 (이 파일)
```

### 단일 HTML 파일 아키텍처
- **전체 시스템이 하나의 HTML 파일에 포함**
- CSS, JavaScript 모두 인라인으로 구현
- 외부 의존성: Tailwind CSS (CDN), Google Fonts
- 배포: GitHub Pages 자동 배포

---

## 📊 데이터 구조 및 시트 연동

### Google Sheets 연동 구조

#### 1. 메인 핸드 데이터 (GID: 1906746276)
```
A: 테이블번호    B: 핸드번호      C: 테이블명
D: 팟금액       E: 보드카드      F: 편집완료
G: 핸드시간     H: 최종파일명     I: AI분석
J: 카메라파일   K: 블라인드      L: 게임타입
M: 플레이어수
```

#### 2. 플레이어 인덱스 (GID: 1354012271)
```
A: 핸드번호    B: 포지션       C: 홀카드
D: 프리플롭    E: 플롭        F: 턴
G: 리버       H: 쇼다운       I: 결과
J: 플레이어명
```

#### 3. Apps Script 백엔드
```
URL: https://script.google.com/macros/s/AKfycbzWfe_4CAKcMAzzoHzJBstQIC7jQxSVC1BO23nYwlU23Pd5vLPLjfUi-gKyqzDYvPRT/exec
용도: Virtual 시트 업데이트 및 데이터 동기화
```

---

## 🔧 핵심 기능 상세

### 1. Virtual 시트 매칭 알고리즘 v8.7.1

#### 개선된 시간 매칭 로직
```javascript
// KST 시간 변환
const targetDate = new Date(targetTime * 1000);
const kstDate = new Date(targetDate.toLocaleString("en-US", {timeZone: "Asia/Seoul"}));

// ±3분 범위 검색
const maxDiffSeconds = 3 * 60;
const targetTotalMinutes = targetHours * 60 + targetMinutes;

// 자정 넘나드는 경우 고려
const altDiff = Math.min(
  Math.abs(cellTotalMinutes - targetTotalMinutes + 1440),
  Math.abs(cellTotalMinutes - targetTotalMinutes - 1440)
);
```

#### 매칭 정확도
- **±3분 범위** 내에서 가장 근접한 시간 검색
- **완벽 일치** 우선, 차이가 있을 경우 초/분 단위로 표시
- **자정 경계** 처리 (23:59 ↔ 00:01)
- **후보 분석** 시스템으로 매칭 품질 검증

### 2. 로컬 상태 관리

#### 마스터 핸드 목록 (LocalStorage)
```javascript
const MASTER_LIST_KEY = 'poker_master_hand_list_v1';
// 저장 데이터: 완료 상태, 파일명, AI 분석, 노트
```

#### 최근 핸드 버퍼
```javascript
const BUFFER_KEY = 'poker_recent_hands_buffer_v2';
// 최대 100개 핸드 추적으로 중복 알림 방지
```

### 3. 데이터 병합 로직

#### CSV 데이터와 로컬 상태 병합
```javascript
const mergedHand = {
  ...hand, // CSV에서 온 새 데이터  
  handEdit: existingHand.isLocallyCompleted || existingHand.handEdit,
  isLocallyCompleted: existingHand.isLocallyCompleted
};
```

**핵심 원칙**: 로컬 완료 상태가 항상 우선권을 가짐

---

## 🎨 UI/UX 설계

### 레이아웃 구조
```
┌─────────────────────────────────────────────────────────────┐
│ Header (버전, 연결상태, Virtual 시트 URL, 새로고침, 설정)          │
├─────────────┬─────────────────────────┬─────────────────────┤
│ 핸드 목록    │ 핸드 상세 정보            │ 통계 & 노트            │
│ - 필터링     │ - 팟 정보               │ - 전체/완료 카운트      │
│ - 상태별     │ - 보드 카드             │ - 핸드 결과           │
│ - 테이블별   │ - 플레이어 정보          │ - 편집 노트           │
│            │ - 액션 히스토리          │                     │
└─────────────┴─────────────────────────┴─────────────────────┘
```

### 컬러 시스템
- **배경**: `#0f172a` → `#1e293b` (그라디언트)
- **카드**: 흰색 배경, 스페이드/클럽(검정), 하트/다이아몬드(빨강)
- **상태**: 완료(초록), 대기(노랑), 에러(빨강)
- **액션**: 단계별 색상 구분 (Preflop→Showdown)

### 반응형 디자인
- **데스크톱**: 3단 그리드 레이아웃
- **태블릿**: 2단으로 축소
- **모바일**: 단일 컬럼 스택

---

## 🚀 버전 히스토리 & 패치 노트

### v9.5.0 (2025-01-10) - 현재 버전
#### 🔧 Virtual 시트 매칭 개선 및 버그 수정
- **Virtual 시트 매칭 로직 전면 개선**
  - CSV 파싱 시 캐리지 리턴(\r) 제거로 파싱 정확도 향상
  - 이스케이프된 따옴표 처리 개선
  - 빈 줄 건너뛰기 로직 추가
  - 시간 패턴 매칭 확장 (10개 이상 형식 지원)
  - 자동 열 감지 기능 추가 (B열 제한 해제)

- **플레이어 칩 정보 표시 개선**
  - 카드 정보 없이 칩 정보만 있는 경우도 정상 표시
  - null 카드 데이터 안전하게 처리
  - "카드 정보 없음" 메시지 추가

- **콘솔 로그 버그 수정**
  - 2039번 줄 중복 console.log 제거
  - 구문 오류 수정으로 Virtual 시트 매칭 정상화

- **버전 동기화**
  - 모든 프로젝트 파일 버전 9.5.0으로 통일
  - README.md 포함 전체 문서 업데이트

### v8.8.0 (2025-09-06)
#### 🚀 주요 기능 개선 - 멀티 플레이어 지원
- **완전한 멀티 플레이어 지원**
  - 단일 핸드에서 모든 플레이어 정보 표시
  - 각 플레이어별 홀카드, 포지션, 액션 분리 표시
  - virtual_data_claude 시스템 로직 분석 및 적용
  - 플레이어 수 및 상세 정보 요약 표시

- **향상된 데이터 구조**
  - handData 객체를 멀티 플레이어 배열 구조로 개선
  - 레거시 단일 플레이어 호환성 유지
  - 플레이어별 개별 액션 히스토리 추적
  - 동일 핸드 내 모든 참여자 데이터 통합

- **UI/UX 개선**
  - 플레이어별 개별 카드 표시
  - 스트리트별 액션 분류 및 구조화
  - 시각적 구분을 위한 카드 디자인 개선
  - 플레이어 수 통계 및 요약 정보

#### 🎯 개발 진행 상황
- **완료된 작업**: virtual_data_claude 분석 및 멀티 플레이어 로직 통합
- **해결된 이슈**: 
  - ✅ 단일 플레이어만 표시되던 제한 해결
  - ✅ 다중 플레이어 핸드 정보 누락 해결
  - ✅ 액션 히스토리 완전성 개선
- **다음 단계**: 실시간 팟 계산 및 승자 결정 로직 추가

### v8.7.1 (2025-09-06) - 이전 버전
#### 🔧 버그 수정 및 안정성 향상
- **카드 파싱 오류 수정**
  - DOMTokenList 빈 토큰 에러 해결 (createCardElement 함수)
  - 유효하지 않은 카드 데이터 검증 로직 추가
  - 빈 문자열 suitClass 처리 개선
  - 알 수 없는 카드 슈트에 대한 안전 장치 구현

- **보드 카드 파싱 로직 개선**
  - 다양한 구분자 지원 (공백, 쉼표, 슬래시, 하이픈, 언더스코어)
  - 보드 카드 데이터 타입 검증 강화
  - 에러 처리 및 로깅 시스템 개선
  - 빈 값 및 잘못된 형식 데이터 처리

- **디버깅 및 모니터링 강화**
  - CSV 데이터 로딩 과정 상세 로깅
  - 핸드 데이터 파싱 단계별 추적
  - 에러 발생 시 구체적 원인 표시
  - Console 기반 실시간 디버깅 지원

#### 🎯 개발 진행 상황
- **현재 상태**: 핵심 기능 안정화 완료
- **해결된 주요 이슈**: 
  - ✅ 카드 렌더링 크래시 방지
  - ✅ 데이터 로딩 실패 원인 진단 개선
  - ✅ 보드 카드 표시 오류 해결
- **다음 단계**: UI/UX 개선 및 성능 최적화 계획

### v8.7.0 (2025-09-06) - 이전 버전
#### 🔥 주요 개선사항
- **Virtual 시트 매칭 알고리즘 대폭 개선**
  - ±3분 범위 검색으로 정확도 향상
  - KST 시간대 변환 로직 강화
  - 자정 경계 처리 추가
  - 후보 분석 시스템 도입

- **완료 상태 복구 시스템**
  - 로컬 완료 상태가 CSV 업데이트 후에도 유지됨
  - 데이터 병합 로직 개선으로 상태 손실 방지

- **에러 처리 강화**
  - AI 분석 실패 시 크래시 방지
  - Virtual 시트 접근 오류 상세 분류
  - Promise.all 에러 핸들링 개선

- **콘솔/대시보드 버전 통합**
  - 모든 버전 표시 v8.7.0으로 일치
  - 일관된 버전 관리 시스템 구축

### v8.6.x (이전 버전들)
- 기본 핸드 모니터링 시스템
- CSV 데이터 파싱 및 표시
- 기본적인 Virtual 시트 연동

### 알려진 이슈 해결
✅ **완료 버튼 누른 핸드가 새로고침 후 다시 미완료로 표시되는 문제**
✅ **AI 분석 실패 시 "Cannot read properties of undefined" 에러**
✅ **Virtual 시트 시간 매칭 정확도 부족**
✅ **콘솔과 대시보드 버전 불일치**
✅ **카드 파싱 오류로 인한 DOMTokenList 크래시** (v8.7.1에서 해결)
✅ **보드 카드 표시 실패 및 빈 데이터 처리** (v8.7.1에서 해결)

---

## 🔧 설치 및 실행

### 로컬 실행
```bash
# 1. 저장소 클론
git clone https://github.com/garimto81/virtual_table_db_gpt.git

# 2. 웹 서버로 실행 (CORS 회피)
python -m http.server 8000
# 또는
npx serve .

# 3. 브라우저에서 접속
http://localhost:8000
```

### GitHub Pages 배포
- **자동 배포**: GitHub Pages 활성화됨
- **URL**: `https://garimto81.github.io/virtual_table_db_gpt/`
- **설정**: `_config.yml`로 Jekyll 테마 설정

### 환경 요구사항
- 모던 웹 브라우저 (Chrome, Firefox, Safari, Edge)
- 인터넷 연결 (Google Sheets API 접근)
- LocalStorage 지원

---

## 🤖 AI 분석 시스템

### 지원 AI 서비스
1. **OpenAI** (GPT-3.5/GPT-4)
2. **Google Gemini** 
3. **Anthropic Claude**
4. **기본 분석** (AI 미사용 시)

### AI 분석 프로세스
```javascript
async function analyzeHandWithAI(hand) {
  // 1. AI 서비스 확인
  // 2. 핸드 데이터 구조화
  // 3. API 호출 및 분석 요청
  // 4. 3줄 요약 생성
  // 5. Virtual 시트 H열 업데이트
}
```

### 분석 출력 형식
- **1줄**: 핸드 상황 요약
- **2줄**: 주요 액션 및 결과
- **3줄**: 전략적 인사이트

---

## 📱 사용자 인터페이스 가이드

### 메인 화면 구성
1. **헤더**: 버전 정보, 연결 상태, Virtual 시트 URL 입력
2. **왼쪽 패널**: 핸드 목록, 필터링 옵션
3. **중앙 패널**: 선택된 핸드의 상세 정보
4. **오른쪽 패널**: 통계, 결과, 노트 편집

### 주요 워크플로우
```
1. 핸드 데이터 자동 로드 (10초 간격)
     ↓
2. 핸드 목록에서 선택
     ↓
3. 상세 정보 확인
     ↓
4. 필요시 노트 작성
     ↓
5. Virtual 시트 URL 입력
     ↓
6. '완료' 버튼으로 마킹
     ↓
7. AI 분석 및 파일명 생성
     ↓
8. Virtual 시트 자동 업데이트
```

---

## 🔍 디버깅 & 모니터링

### 콘솔 명령어
```javascript
// 시스템 정보 확인
window.getVersion()

// 현재 상태 확인
window.getStats()

// 버퍼 상태 확인
recentHandsBuffer.getStatus()
```

### 로그 분석
```javascript
// 초기화 시 출력되는 정보
🚀 포커 핸드 모니터링 시스템 v8.7.0
📋 주요 기능: 키 플레이어 분석 + 개선된 Virtual 시트 매칭
📅 업데이트: 2025-09-06
🔗 대시보드 버전: v8.7.0 (일치)
💾 최근 핸드 버퍼: X/100개
```

### 일반적인 문제 해결
1. **Virtual 시트 매칭 실패**
   - URL 형식 확인
   - 시트 공개 설정 확인
   - 시간대 차이 고려

2. **데이터 로드 실패**
   - 네트워크 연결 확인
   - CORS 정책 확인
   - CSV 형식 검증

3. **완료 상태 손실**
   - LocalStorage 용량 확인
   - 브라우저 데이터 정책 확인

---

## 🔐 보안 & 데이터 처리

### 데이터 보안
- **API 키**: 로컬 브라우저에만 저장
- **개인 정보**: 시트 링크만 저장, 내용은 미저장
- **HTTPS**: 모든 외부 API 호출 암호화

### 개인정보 처리
- **수집 데이터**: 핸드 번호, 게임 데이터만
- **저장 위치**: 사용자 브라우저 LocalStorage
- **외부 전송**: Google Sheets API만 사용

---

## 🚀 향후 계획 & 확장성

### 계획된 기능
- [ ] 다중 테이블 동시 모니터링
- [ ] 실시간 알림 시스템 고도화  
- [ ] 플레이어 통계 및 히트맵
- [ ] 커스텀 AI 프롬프트 설정
- [ ] 데이터 내보내기 (JSON, CSV)

### 기술 부채 관리
- [ ] 컴포넌트 모듈화 (필요시)
- [ ] 타입스크립트 도입 검토
- [ ] 테스트 케이스 작성
- [ ] 성능 최적화

---

## 👥 기여 가이드라인

### 개발 환경 설정
1. 저장소 포크
2. 로컬 클론
3. 기능 브랜치 생성
4. 변경사항 테스트
5. Pull Request 생성

### 코드 스타일
- **들여쓰기**: 2 스페이스
- **명명**: camelCase (변수), PascalCase (클래스)
- **주석**: 복잡한 로직에만 필요
- **버전**: semantic versioning (major.minor.patch)

### 커밋 메시지 형식
```
타입: 간단한 설명

상세 설명 (옵션)
- 변경사항 1
- 변경사항 2

🤖 Generated with [Claude Code](https://claude.ai/code)
Co-Authored-By: Claude <noreply@anthropic.com>
```

---

## 📞 지원 & 연락처

### 이슈 리포팅
- **GitHub Issues**: https://github.com/garimto81/virtual_table_db_gpt/issues
- **버그 리포트**: 재현 단계 상세히 기록
- **기능 요청**: 사용 사례와 함께 제안

### 문서 업데이트
- 이 README.md는 프로젝트의 **단일 진실 원천**
- 모든 변경사항은 이 문서에 반영 필요
- 버전 업데이트 시 패치 노트 업데이트 필수

---

**마지막 업데이트**: 2025-01-10  
**문서 버전**: v9.5.0  
**프로젝트 상태**: 🟢 Active Development

## 🚧 현재 개발 진행 상황 (실시간 업데이트)

### ✅ 완료된 작업 (v9.5.0)
- **Virtual 시트 매칭 완전 정상화**: CSV 파싱 및 시간 매칭 로직 개선
- **플레이어 데이터 표시 안정성**: 부분 데이터도 정상 표시
- **자동 열 감지**: B열 외 다른 열의 시간 데이터도 자동 감지
- **버전 관리 체계화**: 모든 파일 버전 동기화

### ✅ 이전 버전 완료 작업 (v8.8.0)
- **멀티 플레이어 지원**: 단일 핸드에서 모든 플레이어 정보 표시
- **데이터 구조 개선**: virtual_data_claude 시스템 로직 적용
- **UI 완전성**: 플레이어별 홀카드, 포지션, 액션 히스토리
- **호환성 유지**: 레거시 단일 플레이어 시스템과 호환
- **핵심 안정성**: 카드 파싱 오류 해결 및 디버깅 시스템

### 🔄 현재 진행 중인 작업
- **성능 최적화**: 대용량 데이터 처리 개선
- **UI/UX 개선**: 사용자 경험 향상
- **모바일 반응형**: 터치 인터페이스 최적화

### 📋 다음 우선순위 작업
1. **실시간 팟 계산** - 멀티 플레이어 베팅 추적 및 팟 사이즈 계산
2. **승자 결정 시스템** - 핸드 결과 분석 및 배당 계산
3. **플레이어 상태 추적** - Folded/All-in/Active 상태 실시간 관리
4. **데이터 내보내기** - CSV/JSON 포맷 지원
5. **다중 테이블 지원** - 여러 테이블 동시 모니터링

### 🐛 알려진 제한사항
- **브라우저 의존성**: Chrome/Edge 최적화, Firefox 부분 지원
- **대용량 데이터**: 1000+ 핸드 시 성능 저하 가능
- **네트워크 의존**: 오프라인 모드 미지원

### 📈 성능 지표
- **로딩 시간**: 평균 2-3초 (100개 핸드 기준)
- **메모리 사용량**: 약 50-80MB
- **오류율**: <1% (v8.7.1 기준)
- **브라우저 호환성**: 95%+ (모던 브라우저)

---

> 💡 **개발자 노트**: 이 프로젝트는 단일 HTML 파일 구조를 유지하면서도 복잡한 실시간 데이터 처리와 AI 분석을 수행하는 것이 특징입니다. 구조를 변경할 때는 이 철학을 유지해 주세요.