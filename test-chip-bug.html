<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì¹© ì…ë ¥ ë²„ê·¸ í…ŒìŠ¤íŠ¸</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; }
    .test-section { margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 4px; }
    .result { padding: 10px; margin: 10px 0; border-radius: 4px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
    input { padding: 8px; margin: 5px; width: 200px; }
    button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #0056b3; }
    code { background: #f4f4f4; padding: 2px 5px; border-radius: 3px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ° ì¹© ì…ë ¥ ë²„ê·¸ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
      <h2>ë¬¸ì œ ì¬í˜„ í…ŒìŠ¤íŠ¸</h2>
      <input type="text" id="test-input" placeholder="2000000 ì…ë ¥í•´ë³´ì„¸ìš”">
      <button onclick="testFormatting()">í¬ë§· í…ŒìŠ¤íŠ¸</button>
      <div id="format-result"></div>
    </div>
    
    <div class="test-section">
      <h2>initialChips ì²˜ë¦¬ í…ŒìŠ¤íŠ¸</h2>
      <button onclick="testInitialChips()">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
      <div id="chips-result"></div>
    </div>
    
    <div class="test-section">
      <h2>ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸</h2>
      <button onclick="testFullScenario()">ì „ì²´ í…ŒìŠ¤íŠ¸</button>
      <div id="full-result"></div>
    </div>
  </div>

  <script>
    // ì›ë³¸ í•¨ìˆ˜ë“¤
    const formatNumber = (val) => val ? new Intl.NumberFormat('en-US').format(String(val).replace(/,/g,'')) : '';
    const unformatNumber = (val) => String(val || '').replace(/,/g, '');
    
    function testFormatting() {
      const input = document.getElementById('test-input').value;
      const resultDiv = document.getElementById('format-result');
      
      try {
        const unformatted = unformatNumber(input);
        const formatted = formatNumber(unformatted);
        const parsed = parseInt(unformatted, 10);
        
        resultDiv.innerHTML = `
          <div class="result info">
            <strong>ì…ë ¥ê°’:</strong> <code>${input}</code><br>
            <strong>unformatNumber:</strong> <code>${unformatted}</code><br>
            <strong>formatNumber:</strong> <code>${formatted}</code><br>
            <strong>parseInt:</strong> <code>${parsed}</code><br>
            <strong>isNaN:</strong> <code>${isNaN(parsed)}</code>
          </div>
        `;
        
        if (parsed > 1000000) {
          resultDiv.innerHTML += `<div class="result success">âœ… ì •ìƒ: ${formatted}</div>`;
        } else {
          resultDiv.innerHTML += `<div class="result error">âŒ ì˜¤ë¥˜: ê°’ì´ ë„ˆë¬´ ì‘ìŒ</div>`;
        }
      } catch (err) {
        resultDiv.innerHTML = `<div class="result error">âŒ ì˜¤ë¥˜: ${err.message}</div>`;
      }
    }
    
    function testInitialChips() {
      const resultDiv = document.getElementById('chips-result');
      const testCases = [
        { input: '2000000', expected: 2000000 },
        { input: '2,000,000', expected: 2000000 },
        { input: 2000000, expected: 2000000 },
        { input: '1000000', expected: 1000000 },
        { input: '500000', expected: 500000 }
      ];
      
      let html = '<h3>initialChips ë³€í™˜ í…ŒìŠ¤íŠ¸</h3>';
      
      testCases.forEach(test => {
        // ìˆ˜ì • ì „ (ë²„ê·¸ ìˆëŠ” ì½”ë“œ)
        const buggyMaxChips = test.input || Infinity;
        
        // ìˆ˜ì • í›„ (ê³ ì¹œ ì½”ë“œ)
        const fixedMaxChips = parseInt(unformatNumber(test.input) || 0, 10) || Infinity;
        
        const isBuggy = buggyMaxChips === test.input;
        const isFixed = fixedMaxChips === test.expected;
        
        html += `
          <div class="result ${isFixed ? 'success' : 'error'}">
            <strong>ì…ë ¥:</strong> <code>${JSON.stringify(test.input)}</code><br>
            <strong>ë²„ê·¸ ì½”ë“œ ê²°ê³¼:</strong> <code>${buggyMaxChips}</code> ${isBuggy ? '(ë¬¸ìì—´!)' : ''}<br>
            <strong>ìˆ˜ì • ì½”ë“œ ê²°ê³¼:</strong> <code>${fixedMaxChips}</code><br>
            <strong>ì˜ˆìƒê°’:</strong> <code>${test.expected}</code><br>
            <strong>ê²°ê³¼:</strong> ${isFixed ? 'âœ… í†µê³¼' : 'âŒ ì‹¤íŒ¨'}
          </div>
        `;
      });
      
      resultDiv.innerHTML = html;
    }
    
    function testFullScenario() {
      const resultDiv = document.getElementById('full-result');
      
      // ì‹¤ì œ í”Œë ˆì´ì–´ ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜
      const player = {
        name: 'TestPlayer',
        initialChips: '2000000',  // ë¬¸ìì—´ë¡œ ì €ì¥ë¨
        chips: '1800000'
      };
      
      // ë²„ê·¸ ìˆëŠ” ì½”ë“œ ì‹œë®¬ë ˆì´ì…˜
      const buggyCalculation = () => {
        const maxChips = player.initialChips;  // "2000000" (ë¬¸ìì—´)
        const currentContribution = 100000;
        const amount = 50000;
        const allowedAmount = Math.min(amount, Math.max(0, maxChips - currentContribution));
        return allowedAmount;
      };
      
      // ìˆ˜ì •ëœ ì½”ë“œ ì‹œë®¬ë ˆì´ì…˜
      const fixedCalculation = () => {
        const maxChips = parseInt(unformatNumber(player.initialChips) || 0, 10);  // 2000000 (ìˆ«ì)
        const currentContribution = 100000;
        const amount = 50000;
        const allowedAmount = Math.min(amount, Math.max(0, maxChips - currentContribution));
        return allowedAmount;
      };
      
      let buggyResult, fixedResult;
      let buggyError = null, fixedError = null;
      
      try {
        buggyResult = buggyCalculation();
      } catch (err) {
        buggyError = err.message;
      }
      
      try {
        fixedResult = fixedCalculation();
      } catch (err) {
        fixedError = err.message;
      }
      
      resultDiv.innerHTML = `
        <h3>ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸</h3>
        <div class="result info">
          <strong>í”Œë ˆì´ì–´ ë°ì´í„°:</strong><br>
          - initialChips: <code>"2000000"</code> (ë¬¸ìì—´)<br>
          - í˜„ì¬ ê¸°ì—¬ì•¡: <code>100000</code><br>
          - ë² íŒ… ì‹œë„: <code>50000</code>
        </div>
        <div class="result ${buggyError ? 'error' : 'info'}">
          <strong>ë²„ê·¸ ì½”ë“œ ê²°ê³¼:</strong><br>
          ${buggyError ? `ì˜¤ë¥˜: ${buggyError}` : `ê³„ì‚° ê²°ê³¼: ${buggyResult}`}<br>
          ë¬¸ì œ: ë¬¸ìì—´ - ìˆ«ì = NaN â†’ Infinity ë¹„êµ
        </div>
        <div class="result ${fixedError ? 'error' : 'success'}">
          <strong>ìˆ˜ì • ì½”ë“œ ê²°ê³¼:</strong><br>
          ${fixedError ? `ì˜¤ë¥˜: ${fixedError}` : `ê³„ì‚° ê²°ê³¼: ${fixedResult}`}<br>
          âœ… ì •ìƒ ì‘ë™: 50000 (ì˜ˆìƒê°’ê³¼ ì¼ì¹˜)
        </div>
      `;
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
    window.onload = () => {
      document.getElementById('test-input').value = '2000000';
    };
  </script>
</body>
</html>