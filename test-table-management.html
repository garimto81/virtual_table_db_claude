<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í…Œì´ë¸” ê´€ë¦¬ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
  <style>
    html, body { 
      height: 100vh; 
      background: #111827; 
      color: white;
      font-family: 'Noto Sans KR', sans-serif;
    }
    .modal { 
      transition: opacity 0.3s ease; 
      backdrop-filter: blur(4px); 
    }
  </style>
</head>
<body class="bg-gray-900 text-white p-4">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-2xl font-bold mb-4">ğŸ“Š í…Œì´ë¸” ê´€ë¦¬ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>
    
    <!-- í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤ -->
    <div class="bg-gray-800 p-4 rounded-lg mb-4">
      <h2 class="text-lg font-bold mb-2">í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤</h2>
      <div class="flex gap-2 flex-wrap">
        <button onclick="testInitializeSheets()" class="btn bg-green-600 px-4 py-2 rounded">
          1. ì‹œíŠ¸ ì´ˆê¸°í™”
        </button>
        <button onclick="testCreateTable()" class="btn bg-blue-600 px-4 py-2 rounded">
          2. í…Œì´ë¸” ìƒì„±
        </button>
        <button onclick="testAddPlayers()" class="btn bg-purple-600 px-4 py-2 rounded">
          3. í”Œë ˆì´ì–´ ì¶”ê°€
        </button>
        <button onclick="testLoadData()" class="btn bg-yellow-600 px-4 py-2 rounded">
          4. ë°ì´í„° ë¡œë“œ
        </button>
        <button onclick="openTableManagement()" class="btn bg-pink-600 px-4 py-2 rounded">
          5. ê´€ë¦¬ UI ì—´ê¸°
        </button>
      </div>
    </div>

    <!-- ìƒíƒœ í‘œì‹œ -->
    <div class="bg-gray-800 p-4 rounded-lg mb-4">
      <h2 class="text-lg font-bold mb-2">í˜„ì¬ ìƒíƒœ</h2>
      <div id="status-display" class="space-y-2">
        <div>API URL: <span id="api-url" class="text-yellow-400">Not Set</span></div>
        <div>í…Œì´ë¸” ìˆ˜: <span id="table-count" class="text-green-400">0</span></div>
        <div>í”Œë ˆì´ì–´ ìˆ˜: <span id="player-count" class="text-blue-400">0</span></div>
        <div>í˜„ì¬ í…Œì´ë¸”: <span id="current-table" class="text-purple-400">None</span></div>
      </div>
    </div>

    <!-- ë°ì´í„° í‘œì‹œ -->
    <div class="grid grid-cols-2 gap-4">
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-lg font-bold mb-2">í…Œì´ë¸” ëª©ë¡</h2>
        <div id="tables-data" class="text-sm space-y-1 max-h-64 overflow-y-auto">
          <p class="text-gray-500">ë°ì´í„° ì—†ìŒ</p>
        </div>
      </div>
      
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-lg font-bold mb-2">í”Œë ˆì´ì–´ ëª©ë¡</h2>
        <div id="players-data" class="text-sm space-y-1 max-h-64 overflow-y-auto">
          <p class="text-gray-500">ë°ì´í„° ì—†ìŒ</p>
        </div>
      </div>
    </div>

    <!-- ë¡œê·¸ -->
    <div class="bg-gray-800 p-4 rounded-lg mt-4">
      <h2 class="text-lg font-bold mb-2">ì‹¤í–‰ ë¡œê·¸</h2>
      <div id="log-output" class="font-mono text-xs bg-black p-2 rounded h-48 overflow-y-auto">
        <div class="text-gray-400">í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ìœ„ ë²„íŠ¼ì„ ìˆœì„œëŒ€ë¡œ í´ë¦­í•˜ì„¸ìš”</div>
      </div>
    </div>
  </div>

  <!-- í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“ˆ ë¡œë“œ -->
  <script src="table-management-module.js"></script>
  
  <script>
    // Apps Script URL ì„¤ì • (ì‹¤ì œ URLë¡œ êµì²´ í•„ìš”)
    const APPS_SCRIPT_URL = 'YOUR_APPS_SCRIPT_WEB_APP_URL_HERE';
    
    // ì „ì—­ state ê°ì²´ (index.htmlê³¼ í˜¸í™˜)
    const state = {
      playersInHand: []
    };
    
    // ë Œë”ë§ í•¨ìˆ˜ ìŠ¤í… (index.htmlê³¼ í˜¸í™˜)
    function renderPlayerSelection() {
      log('renderPlayerSelection called');
    }
    
    function renderPlayerDetails() {
      log('renderPlayerDetails called');
    }
    
    // ë¡œê·¸ í•¨ìˆ˜
    function log(message, type = 'info') {
      const logOutput = document.getElementById('log-output');
      const time = new Date().toLocaleTimeString();
      const color = type === 'error' ? 'text-red-400' : 
                    type === 'success' ? 'text-green-400' : 
                    type === 'warning' ? 'text-yellow-400' : 'text-gray-300';
      
      logOutput.innerHTML += `
        <div class="${color}">[${time}] ${message}</div>
      `;
      logOutput.scrollTop = logOutput.scrollHeight;
    }
    
    // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
    async function testInitializeSheets() {
      log('ì‹œíŠ¸ ì´ˆê¸°í™” ì‹œì‘...');
      
      try {
        // ì‹¤ì œë¡œëŠ” Apps Scriptì—ì„œ initializeSheets() í˜¸ì¶œ
        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'initializeSheets' })
        });
        
        log('ì‹œíŠ¸ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
      } catch (error) {
        log('ì‹œíŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message, 'error');
      }
    }
    
    async function testCreateTable() {
      log('í…Œì´ë¸” ìƒì„± ì‹œì‘...');
      
      const tables = [
        { name: 'Friday Night Game', stakes: '1/2 NL', maxPlayers: 9 },
        { name: 'High Stakes Table', stakes: '5/10 NL', maxPlayers: 6 },
        { name: 'Tournament Practice', stakes: 'Tournament', maxPlayers: 10 }
      ];
      
      for (const table of tables) {
        const result = await tableManager.createTable(table.name, table.stakes, table.maxPlayers);
        if (result.success) {
          log(`í…Œì´ë¸” ìƒì„±: ${table.name}`, 'success');
        } else {
          log(`í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨: ${table.name}`, 'error');
        }
      }
      
      updateStatus();
    }
    
    async function testAddPlayers() {
      log('í”Œë ˆì´ì–´ ì¶”ê°€ ì‹œì‘...');
      
      // ë¨¼ì € í…Œì´ë¸”ì„ ì„ íƒ
      await tableManager.loadTables();
      if (tableManager.tables.length > 0) {
        await tableManager.selectTable(tableManager.tables[0].TableID);
        log(`í…Œì´ë¸” ì„ íƒ: ${tableManager.tables[0].TableName}`, 'success');
      }
      
      const players = [
        { name: 'John Doe', chips: 100000, seat: 1, notable: true },
        { name: 'Jane Smith', chips: 150000, seat: 2, notable: false },
        { name: 'Mike Johnson', chips: 80000, seat: 3, notable: false },
        { name: 'Sarah Williams', chips: 200000, seat: 4, notable: true },
        { name: 'Tom Brown', chips: 120000, seat: 5, notable: false }
      ];
      
      for (const player of players) {
        const result = await tableManager.addPlayerToCurrentTable(
          player.name, 
          player.chips, 
          player.seat, 
          player.notable
        );
        if (result.success) {
          log(`í”Œë ˆì´ì–´ ì¶”ê°€: ${player.name} (${player.chips} ì¹©)`, 'success');
        } else {
          log(`í”Œë ˆì´ì–´ ì¶”ê°€ ì‹¤íŒ¨: ${player.name}`, 'error');
        }
      }
      
      updateStatus();
    }
    
    async function testLoadData() {
      log('ë°ì´í„° ë¡œë“œ ì‹œì‘...');
      
      await tableManager.loadTables();
      await tableManager.loadPlayers();
      
      log(`í…Œì´ë¸” ${tableManager.tables.length}ê°œ ë¡œë“œë¨`, 'success');
      log(`í”Œë ˆì´ì–´ ${tableManager.players.length}ëª… ë¡œë“œë¨`, 'success');
      
      displayData();
      updateStatus();
    }
    
    function displayData() {
      // í…Œì´ë¸” ë°ì´í„° í‘œì‹œ
      const tablesDiv = document.getElementById('tables-data');
      if (tableManager.tables.length > 0) {
        tablesDiv.innerHTML = tableManager.tables.map(table => `
          <div class="bg-gray-700 p-2 rounded">
            <div class="font-bold">${table.TableName}</div>
            <div class="text-xs text-gray-400">
              ${table.Stakes} | ìµœëŒ€ ${table.MaxPlayers}ëª…
            </div>
          </div>
        `).join('');
      }
      
      // í”Œë ˆì´ì–´ ë°ì´í„° í‘œì‹œ
      const playersDiv = document.getElementById('players-data');
      if (tableManager.players.length > 0) {
        playersDiv.innerHTML = tableManager.players.map(player => `
          <div class="bg-gray-700 p-2 rounded">
            <div class="font-bold">
              ${player.Notable ? 'â­' : ''} ${player.Name}
            </div>
            <div class="text-xs text-gray-400">
              ì¹©: ${formatNumber(player.CurrentChips || 0)}
            </div>
          </div>
        `).join('');
      }
    }
    
    function updateStatus() {
      document.getElementById('api-url').textContent = APPS_SCRIPT_URL || 'Not Set';
      document.getElementById('table-count').textContent = tableManager.tables.length;
      document.getElementById('player-count').textContent = tableManager.players.length;
      document.getElementById('current-table').textContent = 
        tableManager.currentTable ? tableManager.currentTable.TableName : 'None';
    }
    
    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', () => {
      log('í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
      tableManager.apiUrl = APPS_SCRIPT_URL;
      updateStatus();
    });
  </script>
</body>
</html>